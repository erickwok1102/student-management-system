<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>å­¸å“¡ç®¡ç†ç³»çµ± - å®Œæ•´ç‰ˆæœ¬ v2.1</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); 
            color: #333; 
            min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; padding: 40px; border-radius: 20px; margin-bottom: 30px; 
            text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .header p { font-size: 1.2rem; opacity: 0.9; }
        .card { 
            background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
            border-radius: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); 
            padding: 30px; margin-bottom: 25px; border: 1px solid rgba(255,255,255,0.2);
        }
        .btn { 
            padding: 14px 28px; border: none; border-radius: 12px; cursor: pointer; 
            font-size: 16px; margin: 8px; transition: all 0.3s ease; font-weight: 600;
        }
        .btn-primary { background: linear-gradient(135deg, #007bff, #0056b3); color: white; }
        .btn-success { background: linear-gradient(135deg, #28a745, #1e7e34); color: white; }
        .btn-warning { background: linear-gradient(135deg, #ffc107, #e0a800); color: #212529; }
        .btn-danger { background: linear-gradient(135deg, #dc3545, #c82333); color: white; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        
        .form-group { margin-bottom: 25px; }
        .form-group label { 
            display: block; margin-bottom: 8px; font-weight: 600; 
            color: #555; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .form-group input, .form-group select, .form-group textarea { 
            width: 100%; padding: 15px 20px; border: 2px solid #e1e5e9; 
            border-radius: 12px; font-size: 16px; transition: all 0.3s ease;
            background: rgba(255,255,255,0.8);
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none; border-color: #007bff; 
            box-shadow: 0 0 0 4px rgba(0,123,255,0.1);
            background: white;
        }
        
        .student-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 25px; border-radius: 15px; margin-bottom: 15px; 
            background: linear-gradient(135deg, #f8f9fa, #e9ecef); 
            transition: all 0.3s ease; border-left: 5px solid #007bff;
        }
        .student-item:hover { 
            background: linear-gradient(135deg, #e9ecef, #dee2e6); 
            transform: translateX(10px); box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .notification { 
            position: fixed; top: 30px; right: 30px; padding: 20px 30px; 
            border-radius: 15px; color: white; font-weight: 600; z-index: 1000; 
            opacity: 0; transition: all 0.4s ease; box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .notification.success { background: linear-gradient(135deg, #28a745, #20c997); }
        .notification.error { background: linear-gradient(135deg, #dc3545, #e74c3c); }
        .notification.warning { background: linear-gradient(135deg, #ffc107, #f39c12); color: #333; }
        .notification.show { opacity: 1; transform: translateY(0); }
        
        .status-indicator { 
            display: inline-block; width: 14px; height: 14px; border-radius: 50%; 
            margin-left: 10px; animation: pulse 2s infinite;
        }
        .status-online { background: #28a745; box-shadow: 0 0 15px rgba(40,167,69,0.6); }
        .status-offline { background: #dc3545; box-shadow: 0 0 15px rgba(220,53,69,0.6); }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .tabs { 
            display: flex; border-bottom: 3px solid #e9ecef; margin-bottom: 30px; 
            background: rgba(255,255,255,0.9); border-radius: 15px 15px 0 0; 
            overflow: hidden; backdrop-filter: blur(10px);
        }
        .tab { 
            padding: 20px 35px; cursor: pointer; border: none; background: none; 
            font-size: 16px; font-weight: 600; transition: all 0.3s ease; 
            position: relative; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .tab.active { 
            background: linear-gradient(135deg, #007bff, #0056b3); 
            color: white; 
        }
        .tab:not(.active):hover { background: rgba(0,123,255,0.1); }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s ease; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .grid-form { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 25px; 
        }
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 25px; 
        }
        .stat-card { 
            background: linear-gradient(135deg, #f8f9fa, #e9ecef); 
            padding: 30px; border-radius: 20px; text-align: center; 
            border-left: 6px solid #007bff; transition: all 0.3s ease;
        }
        .stat-card:hover { 
            transform: translateY(-8px); 
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }
        
        .sync-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 30px; 
        }
        .sync-card { 
            text-align: center; padding: 40px; border-radius: 20px; 
            background: linear-gradient(135deg, #f8f9fa, #e9ecef); 
            transition: all 0.3s ease;
        }
        .sync-card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
        }
        
        .empty-state { 
            text-align: center; padding: 80px 20px; color: #999; 
        }
        .empty-state h3 { 
            margin-bottom: 15px; color: #666; font-size: 24px; 
        }
        .empty-state p { font-size: 16px; line-height: 1.6; }
        
        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .header { padding: 30px 20px; }
            .header h1 { font-size: 2rem; }
            .grid-form { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); gap: 15px; }
            .sync-grid { grid-template-columns: 1fr; }
            .tabs { flex-wrap: wrap; }
            .tab { padding: 15px 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ å­¸å“¡ç®¡ç†ç³»çµ±</h1>
            <p>Vercel + Google Sheets ç‰ˆæœ¬</p>
            <div style="margin-top: 20px;">
                <span style="font-size: 16px;">ä¼ºæœå™¨ç‹€æ…‹:</span>
                <span class="status-indicator status-offline" id="serverStatus"></span>
                <span id="statusText" style="font-weight: 600;">æª¢æ¸¬ä¸­...</span>
            </div>
        </div>

        <!-- æ¨™ç±¤é å°èˆª -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('students', this)">ğŸ‘¥ å­¸å“¡ç®¡ç†</button>
            <button class="tab" onclick="showTab('sync', this)">â˜ï¸ é›²ç«¯åŒæ­¥</button>
            <button class="tab" onclick="showTab('stats', this)">ğŸ“Š çµ±è¨ˆå ±è¡¨</button>
        </div>

        <!-- å­¸å“¡ç®¡ç†æ¨™ç±¤ -->
        <div id="studentsTab" class="tab-content active">
            <div class="card">
                <h3 style="margin-bottom: 30px; color: #333; font-size: 24px;">â• æ–°å¢å­¸å“¡</h3>
                <div class="grid-form">
                    <div class="form-group">
                        <label>å­¸å“¡å§“å *</label>
                        <input type="text" id="studentName" placeholder="è«‹è¼¸å…¥å­¸å“¡å§“å" required>
                    </div>
                    <div class="form-group">
                        <label>åˆ¥å/è‹±æ–‡å</label>
                        <input type="text" id="studentNickname" placeholder="åˆ¥åæˆ–è‹±æ–‡å (é¸å¡«)">
                    </div>
                    <div class="form-group">
                        <label>ç­åˆ¥</label>
                        <select id="studentClass">
                            <option value="">è«‹é¸æ“‡ç­åˆ¥</option>
                            <option value="æ•¸å­¸ç­">æ•¸å­¸ç­</option>
                            <option value="è‹±æ–‡ç­">è‹±æ–‡ç­</option>
                            <option value="ä¸­æ–‡ç­">ä¸­æ–‡ç­</option>
                            <option value="ç§‘å­¸ç­">ç§‘å­¸ç­</option>
                            <option value="éŸ³æ¨‚ç­">éŸ³æ¨‚ç­</option>
                            <option value="ç¾è¡“ç­">ç¾è¡“ç­</option>
                            <option value="é«”è‚²ç­">é«”è‚²ç­</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>è¯çµ¡é›»è©±</label>
                        <input type="tel" id="studentPhone" placeholder="è¯çµ¡é›»è©±">
                    </div>
                    <div class="form-group">
                        <label>é›»å­ä¿¡ç®±</label>
                        <input type="email" id="studentEmail" placeholder="é›»å­ä¿¡ç®±">
                    </div>
                    <div class="form-group">
                        <label>ç‹€æ…‹</label>
                        <select id="studentStatus">
                            <option value="åœ¨è®€">åœ¨è®€</option>
                            <option value="ä¼‘å­¸">ä¼‘å­¸</option>
                            <option value="ç•¢æ¥­">ç•¢æ¥­</option>
                            <option value="é€€å­¸">é€€å­¸</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>å‚™è¨»</label>
                    <textarea id="studentRemarks" placeholder="å…¶ä»–å‚™è¨»è³‡è¨Š" rows="4"></textarea>
                </div>
                <div style="margin-top: 30px; text-align: center;">
                    <button class="btn btn-success" onclick="addStudent()">â• æ–°å¢å­¸å“¡</button>
                    <button class="btn btn-primary" onclick="loadStudents()">ğŸ”„ é‡æ–°è¼‰å…¥</button>
                    <button class="btn btn-warning" onclick="clearForm()">ğŸ§¹ æ¸…ç©ºè¡¨å–®</button>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 25px; color: #333; font-size: 24px;">ğŸ“‹ å­¸å“¡åˆ—è¡¨</h3>
                <div class="student-list" id="studentList">
                    <div class="empty-state">
                        <h3>ğŸ”„ è¼‰å…¥ä¸­...</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- é›²ç«¯åŒæ­¥æ¨™ç±¤ -->
        <div id="syncTab" class="tab-content">
            <div class="card">
                <h3 style="margin-bottom: 30px; color: #333; font-size: 24px;">â˜ï¸ Google Sheets åŒæ­¥</h3>
                <div class="sync-grid">
                    <div class="sync-card">
                        <h4 style="color: #28a745; margin-bottom: 20px; font-size: 20px;">ğŸ“¤ ä¸Šå‚³åˆ°é›²ç«¯</h4>
                        <button class="btn btn-success" onclick="syncToCloud()" style="width: 100%; margin-bottom: 20px;">
                            â˜ï¸ åŒæ­¥å­¸å“¡åˆ°é›²ç«¯
                        </button>
                        <p style="font-size: 14px; color: #666; line-height: 1.6;">
                            å°‡æœ¬åœ°å­¸å“¡è³‡æ–™ä¸Šå‚³åˆ° Google Sheets<br>
                            <strong>æ³¨æ„ï¼š</strong>æœƒè¦†è“‹é›²ç«¯ç¾æœ‰è³‡æ–™
                        </p>
                    </div>
                    <div class="sync-card">
                        <h4 style="color: #007bff; margin-bottom: 20px; font-size: 20px;">ï¿½ï¿½ å¾é›²ç«¯è¼‰å…¥</h4>
                        <button class="btn btn-primary" onclick="loadFromCloud()" style="width: 100%; margin-bottom: 20px;">
                            ğŸ“¥ å¾é›²ç«¯è¼‰å…¥
                        </button>
                        <p style="font-size: 14px; color: #666; line-height: 1.6;">
                            å¾ Google Sheets è¼‰å…¥å­¸å“¡è³‡æ–™<br>
                            <strong>æ³¨æ„ï¼š</strong>æœƒè¦†è“‹æœ¬åœ°ç¾æœ‰è³‡æ–™
                        </p>
                    </div>
                </div>
                
                <div style="margin-top: 40px; padding: 25px; background: rgba(248,249,250,0.8); border-radius: 15px;">
                    <h4 style="color: #333; margin-bottom: 15px; font-size: 18px;">ğŸ“‹ åŒæ­¥ç‹€æ…‹</h4>
                    <p id="syncStatus" style="color: #666; font-size: 16px;">å°šæœªé€²è¡ŒåŒæ­¥æ“ä½œ</p>
                </div>
            </div>
        </div>

        <!-- çµ±è¨ˆå ±è¡¨æ¨™ç±¤ -->
        <div id="statsTab" class="tab-content">
            <div class="card">
                <h3 style="margin-bottom: 30px; color: #333; font-size: 24px;">ğŸ“Š çµ±è¨ˆå ±è¡¨</h3>
                <div class="stats-grid">
                    <div class="stat-card" style="border-left-color: #007bff;">
                        <h4 style="color: #007bff; margin-bottom: 15px; font-size: 18px;">ç¸½å­¸å“¡æ•¸</h4>
                        <p style="font-size: 48px; font-weight: bold; margin: 15px 0; color: #333;" id="totalStudents">0</p>
                        <small style="color: #666;">å…¨éƒ¨å­¸å“¡</small>
                    </div>
                    <div class="stat-card" style="border-left-color: #28a745;">
                        <h4 style="color: #28a745; margin-bottom: 15px; font-size: 18px;">åœ¨è®€å­¸å“¡</h4>
                        <p style="font-size: 48px; font-weight: bold; margin: 15px 0; color: #333;" id="activeStudents">0</p>
                        <small style="color: #666;">ç›®å‰å°±è®€</small>
                    </div>
                    <div class="stat-card" style="border-left-color: #ffc107;">
                        <h4 style="color: #f39c12; margin-bottom: 15px; font-size: 18px;">ä¼‘å­¸å­¸å“¡</h4>
                        <p style="font-size: 48px; font-weight: bold; margin: 15px 0; color: #333;" id="suspendedStudents">0</p>
                        <small style="color: #666;">æš«æ™‚ä¼‘å­¸</small>
                    </div>
                    <div class="stat-card" style="border-left-color: #6c757d;">
                        <h4 style="color: #6c757d; margin-bottom: 15px; font-size: 18px;">ç•¢æ¥­å­¸å“¡</h4>
                        <p style="font-size: 48px; font-weight: bold; margin: 15px 0; color: #333;" id="graduatedStudents">0</p>
                        <small style="color: #666;">å·²ç¶“ç•¢æ¥­</small>
                    </div>
                </div>
                
                <div style="margin-top: 40px; text-align: center;">
                    <button class="btn btn-primary" onclick="updateStatistics()">ğŸ”„ æ›´æ–°çµ±è¨ˆ</button>
                    <button class="btn btn-success" onclick="exportStudentList()">ğŸ“„ åŒ¯å‡ºå­¸å“¡æ¸…å–®</button>
                </div>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥å…ƒç´  -->
    <div id="notification" class="notification"></div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let students = [];

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸš€ å­¸å“¡ç®¡ç†ç³»çµ±å•Ÿå‹•ä¸­...');
            showNotification('æ­¡è¿ä½¿ç”¨å­¸å“¡ç®¡ç†ç³»çµ±ï¼', 'success');
            await checkServerStatus();
            await loadStudents();
            await loadFromCloudSilently();
            updateStatistics();
        });

        // æª¢æŸ¥ä¼ºæœå™¨ç‹€æ…‹
        async function checkServerStatus() {
            try {
                document.getElementById('statusText').textContent = 'æª¢æ¸¬ä¸­...';
                const response = await fetch('/api/get-students');
                
                if (response.ok) {
                    document.getElementById('serverStatus').className = 'status-indicator status-online';
                    document.getElementById('statusText').textContent = 'ç·šä¸Š';
                    console.log('âœ… API ä¼ºæœå™¨é€£ç·šæ­£å¸¸');
                    showNotification('é›²ç«¯æœå‹™å·²é€£æ¥', 'success');
                } else {
                    throw new Error(\`HTTP \${response.status}\`);
                }
            } catch (error) {
                document.getElementById('serverStatus').className = 'status-indicator status-offline';
                document.getElementById('statusText').textContent = 'é›¢ç·š';
                console.log('âš ï¸ API ä¼ºæœå™¨é›¢ç·šï¼Œä½¿ç”¨æœ¬åœ°æ¨¡å¼');
                showNotification('ä½¿ç”¨æœ¬åœ°æ¨¡å¼ï¼ˆé›²ç«¯åŠŸèƒ½æš«ä¸å¯ç”¨ï¼‰', 'warning');
            }
        }

        // æ¨™ç±¤é åˆ‡æ›
        function showTab(tabName, element) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            if (element) {
                element.classList.add('active');
            }
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            if (tabName === 'stats') {
                updateStatistics();
            }
        }

        // é¡¯ç¤ºé€šçŸ¥
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = \`notification \${type} show\`;
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // æ–°å¢å­¸å“¡
        async function addStudent() {
            const name = document.getElementById('studentName').value.trim();
            if (!name) {
                showNotification('è«‹è¼¸å…¥å­¸å“¡å§“å', 'error');
                return;
            }

            const student = {
                id: Date.now().toString(),
                name: name,
                nickname: document.getElementById('studentNickname').value.trim(),
                class: document.getElementById('studentClass').value,
                phone: document.getElementById('studentPhone').value.trim(),
                email: document.getElementById('studentEmail').value.trim(),
                status: document.getElementById('studentStatus').value,
                remarks: document.getElementById('studentRemarks').value.trim(),
                createdAt: new Date().toLocaleDateString('zh-TW')
            };

            students.push(student);
            localStorage.setItem('studentData', JSON.stringify(students));
            
            clearForm();
            displayStudents();
            updateStatistics();
            showNotification(\`âœ… å­¸å“¡ã€Œ\${name}ã€å·²æˆåŠŸæ–°å¢\`, 'success');
            
            setTimeout(() => {
                syncToCloudSilently();
            }, 1000);
        }

        // æ¸…ç©ºè¡¨å–®
        function clearForm() {
            document.getElementById('studentName').value = '';
            document.getElementById('studentNickname').value = '';
            document.getElementById('studentClass').value = '';
            document.getElementById('studentPhone').value = '';
            document.getElementById('studentEmail').value = '';
            document.getElementById('studentStatus').value = 'åœ¨è®€';
            document.getElementById('studentRemarks').value = '';
        }

        // è¼‰å…¥å­¸å“¡è³‡æ–™
        async function loadStudents() {
            const localData = localStorage.getItem('studentData');
            if (localData) {
                try {
                    students = JSON.parse(localData);
                    console.log(\`ğŸ“š è¼‰å…¥ \${students.length} ç­†æœ¬åœ°å­¸å“¡è³‡æ–™\`);
                } catch (error) {
                    console.error('æœ¬åœ°è³‡æ–™è§£æå¤±æ•—:', error);
                    students = [];
                }
            } else {
                students = [];
            }
            
            displayStudents();
            updateStatistics();
        }

        // é¡¯ç¤ºå­¸å“¡åˆ—è¡¨
        function displayStudents() {
            const list = document.getElementById('studentList');
            
            if (students.length === 0) {
                list.innerHTML = \`
                    <div class="empty-state">
                        <h3>ğŸ“š é‚„æ²’æœ‰å­¸å“¡è³‡æ–™</h3>
                        <p>é»æ“Šä¸Šæ–¹çš„ã€Œæ–°å¢å­¸å“¡ã€æŒ‰éˆ•é–‹å§‹å»ºç«‹ä½ çš„å­¸å“¡åå†Š<br>
                        æ‰€æœ‰è³‡æ–™æœƒå®‰å…¨åœ°å„²å­˜åœ¨ä½ çš„ç€è¦½å™¨ä¸­</p>
                    </div>
                \`;
                return;
            }

            list.innerHTML = students.map(student => \`
                <div class="student-item">
                    <div>
                        <div style="font-size: 20px; font-weight: 700; margin-bottom: 8px; color: #333;">
                            \${student.name}
                            \${student.nickname ? \`<span style="color: #666; font-weight: 400; font-size: 16px;">(\${student.nickname})</span>\` : ''}
                        </div>
                        <div style="color: #666; font-size: 15px; margin-bottom: 5px;">
                            <span style="margin-right: 20px; background: #e3f2fd; padding: 4px 12px; border-radius: 20px; color: #1976d2;">
                                ğŸ“š \${student.class || 'æœªåˆ†é…ç­åˆ¥'}
                            </span>
                            <span style="color: \${getStatusColor(student.status)}; font-weight: 600;">
                                â— \${student.status}
                            </span>
                        </div>
                        <div style="color: #999; font-size: 13px;">
                            ğŸ“… \${student.createdAt} å»ºç«‹
                            \${student.phone ? \` | ğŸ“ \${student.phone}\` : ''}
                            \${student.email ? \` | ğŸ“§ \${student.email}\` : ''}
                        </div>
                    </div>
                    <div>
                        <button class="btn btn-danger" onclick="deleteStudent('\${student.id}')" 
                                title="åˆªé™¤å­¸å“¡" style="padding: 10px 15px;">
                            ğŸ—‘ï¸
                        </button>
                    </div>
                </div>
            \`).join('');
        }

        // å–å¾—ç‹€æ…‹é¡è‰²
        function getStatusColor(status) {
            switch (status) {
                case 'åœ¨è®€': return '#28a745';
                case 'ä¼‘å­¸': return '#ffc107';
                case 'ç•¢æ¥­': return '#6c757d';
                case 'é€€å­¸': return '#dc3545';
                default: return '#007bff';
            }
        }

        // åˆªé™¤å­¸å“¡
        function deleteStudent(id) {
            const student = students.find(s => s.id === id);
            if (!student) return;
            
            if (confirm(\`âš ï¸ ç¢ºå®šè¦åˆªé™¤å­¸å“¡ã€Œ\${student.name}ã€å—ï¼Ÿ\\n\\næ­¤æ“ä½œç„¡æ³•å¾©åŸï¼Œè«‹è¬¹æ…è€ƒæ…®ã€‚\`)) {
                students = students.filter(s => s.id !== id);
                localStorage.setItem('studentData', JSON.stringify(students));
                displayStudents();
                updateStatistics();
                showNotification(\`ï¿½ï¿½ï¸ å­¸å“¡ã€Œ\${student.name}ã€å·²åˆªé™¤\`, 'warning');
            }
        }

        // åŒæ­¥åˆ°é›²ç«¯
        async function syncToCloud() {
            if (students.length === 0) {
                showNotification('æ²’æœ‰å­¸å“¡è³‡æ–™å¯åŒæ­¥', 'warning');
                return;
            }

            try {
                showNotification('æ­£åœ¨åŒæ­¥åˆ°é›²ç«¯...', 'warning');
                document.getElementById('syncStatus').textContent = 'æ­£åœ¨ä¸Šå‚³è³‡æ–™åˆ° Google Sheets...';
                
                const response = await fetch('/api/sync-students', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ students })
                });

                const result = await response.json();
                
                if (result.success) {
                    showNotification(\`âœ… \${result.message}\`, 'success');
                    document.getElementById('syncStatus').textContent = \`âœ… \${result.message} (\${new Date().toLocaleString('zh-TW')})\`;
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('åŒæ­¥å¤±æ•—:', error);
                showNotification('âŒ åŒæ­¥å¤±æ•—: ' + error.message, 'error');
                document.getElementById('syncStatus').textContent = \`âŒ åŒæ­¥å¤±æ•—: \${error.message}\`;
            }
        }

        // éœé»˜åŒæ­¥åˆ°é›²ç«¯
        async function syncToCloudSilently() {
            if (students.length === 0) return;
            try {
                await fetch('/api/sync-students', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ students })
                });
                console.log(\`ğŸ”„ è‡ªå‹•åŒæ­¥ \${students.length} ç­†å­¸å“¡è³‡æ–™åˆ°é›²ç«¯\`);
            } catch (error) {
                console.log('ğŸ”„ è‡ªå‹•åŒæ­¥å¤±æ•—');
            }
        }

        // å¾é›²ç«¯è¼‰å…¥
        async function loadFromCloud() {
            try {
                showNotification('æ­£åœ¨å¾é›²ç«¯è¼‰å…¥...', 'warning');
                document.getElementById('syncStatus').textContent = 'æ­£åœ¨å¾ Google Sheets è¼‰å…¥è³‡æ–™...';
                
                const response = await fetch('/api/get-students');
                const result = await response.json();
                
                if (result.success && result.students) {
                    students = result.students;
                    localStorage.setItem('studentData', JSON.stringify(students));
                    displayStudents();
                    updateStatistics();
                    showNotification(\`âœ… æˆåŠŸè¼‰å…¥ \${result.count} ç­†å­¸å“¡è³‡æ–™\`, 'success');
                    document.getElementById('syncStatus').textContent = \`âœ… æˆåŠŸè¼‰å…¥ \${result.count} ç­†è³‡æ–™ (\${new Date().toLocaleString('zh-TW')})\`;
                } else {
                    throw new Error(result.error || 'è¼‰å…¥å¤±æ•—');
                }
            } catch (error) {
                console.error('è¼‰å…¥å¤±æ•—:', error);
                showNotification('âŒ è¼‰å…¥å¤±æ•—: ' + error.message, 'error');
                document.getElementById('syncStatus').textContent = \`âŒ è¼‰å…¥å¤±æ•—: \${error.message}\`;
            }
        }

        // éœé»˜å¾é›²ç«¯è¼‰å…¥
        async function loadFromCloudSilently() {
            try {
                const response = await fetch('/api/get-students');
                const result = await response.json();
                
                if (result.success && result.students && result.students.length > 0) {
                    if (result.students.length >= students.length) {
                        students = result.students;
                        localStorage.setItem('studentData', JSON.stringify(students));
                        displayStudents();
                        console.log(\`ğŸ”„ è‡ªå‹•è¼‰å…¥ \${result.count} ç­†é›²ç«¯å­¸å“¡è³‡æ–™\`);
                    }
                }
            } catch (error) {
                console.log('ğŸ“± ä½¿ç”¨æœ¬åœ°æ¨¡å¼');
            }
        }

        // æ›´æ–°çµ±è¨ˆ
        function updateStatistics() {
            const total = students.length;
            const active = students.filter(s => s.status === 'åœ¨è®€').length;
            const suspended = students.filter(s => s.status === 'ä¼‘å­¸').length;
            const graduated = students.filter(s => s.status === 'ç•¢æ¥­').length;

            document.getElementById('totalStudents').textContent = total;
            document.getElementById('activeStudents').textContent = active;
            document.getElementById('suspendedStudents').textContent = suspended;
            document.getElementById('graduatedStudents').textContent = graduated;
        }

        // åŒ¯å‡ºå­¸å“¡æ¸…å–®
        function exportStudentList() {
            if (students.length === 0) {
                showNotification('æ²’æœ‰å­¸å“¡è³‡æ–™å¯åŒ¯å‡º', 'warning');
                return;
            }

            const csvContent = "data:text/csv;charset=utf-8," 
                + "å­¸å“¡å§“å,åˆ¥å,ç­åˆ¥,é›»è©±,ä¿¡ç®±,ç‹€æ…‹,å»ºç«‹æ—¥æœŸ,å‚™è¨»\\n"
                + students.map(student => 
                    \`"\${student.name}","\${student.nickname || ''}","\${student.class || ''}","\${student.phone || ''}","\${student.email || ''}","\${student.status}","\${student.createdAt}","\${student.remarks || ''}"\`
                ).join("\\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", \`å­¸å“¡æ¸…å–®_\${new Date().toLocaleDateString('zh-TW').replace(/\\//g, '-')}.csv\`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification(\`ğŸ“„ å­¸å“¡æ¸…å–®å·²åŒ¯å‡º (\${students.length} ç­†è³‡æ–™)\`, 'success');
        }
    </script>
</body>
</html>
