<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">
    <title>Â≠∏Âì°ÁÆ°ÁêÜÁ≥ªÁµ± - ‰øÆÂæ©Áâà v2.3</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); 
            color: #333; 
            min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; padding: 40px; border-radius: 20px; margin-bottom: 30px; 
            text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .header p { font-size: 1.2rem; opacity: 0.9; }
        .card { 
            background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
            border-radius: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); 
            padding: 30px; margin-bottom: 25px; border: 1px solid rgba(255,255,255,0.2);
        }
        .btn { 
            padding: 14px 28px; border: none; border-radius: 12px; cursor: pointer; 
            font-size: 16px; margin: 8px; transition: all 0.3s ease; font-weight: 600;
        }
        .btn-primary { background: linear-gradient(135deg, #007bff, #0056b3); color: white; }
        .btn-success { background: linear-gradient(135deg, #28a745, #1e7e34); color: white; }
        .btn-warning { background: linear-gradient(135deg, #ffc107, #e0a800); color: #212529; }
        .btn-danger { background: linear-gradient(135deg, #dc3545, #c82333); color: white; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        
        .form-group { margin-bottom: 25px; }
        .form-group label { 
            display: block; margin-bottom: 8px; font-weight: 600; 
            color: #555; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .form-group input, .form-group select, .form-group textarea { 
            width: 100%; padding: 15px 20px; border: 2px solid #e1e5e9; 
            border-radius: 12px; font-size: 16px; transition: all 0.3s ease;
            background: rgba(255,255,255,0.8);
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none; border-color: #007bff; 
            box-shadow: 0 0 0 4px rgba(0,123,255,0.1);
            background: white;
        }
        
        .student-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 25px; border-radius: 15px; margin-bottom: 15px; 
            background: linear-gradient(135deg, #f8f9fa, #e9ecef); 
            transition: all 0.3s ease; border-left: 5px solid #007bff;
        }
        .student-item:hover { 
            background: linear-gradient(135deg, #e9ecef, #dee2e6); 
            transform: translateX(10px); box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .notification { 
            position: fixed; top: 30px; right: 30px; padding: 20px 30px; 
            border-radius: 15px; color: white; font-weight: 600; z-index: 1000; 
            opacity: 0; transition: all 0.4s ease; box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .notification.success { background: linear-gradient(135deg, #28a745, #20c997); }
        .notification.error { background: linear-gradient(135deg, #dc3545, #e74c3c); }
        .notification.warning { background: linear-gradient(135deg, #ffc107, #f39c12); color: #333; }
        .notification.show { opacity: 1; transform: translateY(0); }
        
        .status-indicator { 
            display: inline-block; width: 14px; height: 14px; border-radius: 50%; 
            margin-left: 10px; animation: pulse 2s infinite;
        }
        .status-online { background: #28a745; box-shadow: 0 0 15px rgba(40,167,69,0.6); }
        .status-offline { background: #dc3545; box-shadow: 0 0 15px rgba(220,53,69,0.6); }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .tabs { 
            display: flex; border-bottom: 3px solid #e9ecef; margin-bottom: 30px; 
            background: rgba(255,255,255,0.9); border-radius: 15px 15px 0 0; 
            overflow: hidden; backdrop-filter: blur(10px);
        }
        .tab { 
            padding: 20px 35px; cursor: pointer; border: none; background: none; 
            font-size: 16px; font-weight: 600; transition: all 0.3s ease; 
            position: relative; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .tab.active { 
            background: linear-gradient(135deg, #007bff, #0056b3); 
            color: white; 
        }
        .tab:not(.active):hover { background: rgba(0,123,255,0.1); }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s ease; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .grid-form { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 25px; 
        }
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 25px; 
        }
        .stat-card { 
            background: linear-gradient(135deg, #f8f9fa, #e9ecef); 
            padding: 30px; border-radius: 20px; text-align: center; 
            border-left: 6px solid #007bff; transition: all 0.3s ease;
        }
        .stat-card:hover { 
            transform: translateY(-8px); 
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }
        
        .sync-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 30px; 
        }
        .sync-card { 
            text-align: center; padding: 40px; border-radius: 20px; 
            background: linear-gradient(135deg, #f8f9fa, #e9ecef); 
            transition: all 0.3s ease;
        }
        .sync-card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
        }
        
        .empty-state { 
            text-align: center; padding: 80px 20px; color: #999; 
        }
        .empty-state h3 { 
            margin-bottom: 15px; color: #666; font-size: 24px; 
        }
        .empty-state p { font-size: 16px; line-height: 1.6; }
        
        /* ÈªûÂêçÊåâÈàïÊ®£Âºè */
        .attendance-btn, .attendance-choice-btn {
            transition: all 0.3s ease !important;
            border: 2px solid transparent !important;
            font-weight: 600 !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            cursor: pointer !important;
        }
        
        .attendance-btn:hover, .attendance-choice-btn:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2) !important;
        }
        
        .attendance-btn:active, .attendance-choice-btn:active {
            transform: translateY(0) !important;
        }
        
        .attendance-btn.selected, .attendance-choice-btn.selected {
            border: 3px solid #fff !important;
            box-shadow: 0 0 0 4px rgba(13, 110, 253, 0.25), 0 4px 12px rgba(0,0,0,0.3) !important;
            transform: scale(0.95) !important;
        }
        
        .attendance-btn .check-mark, .attendance-choice-btn .check-mark {
            animation: checkMarkAppear 0.3s ease !important;
        }
        
        @keyframes checkMarkAppear {
            0% { 
                transform: scale(0) rotate(180deg); 
                opacity: 0; 
            }
            50% { 
                transform: scale(1.2) rotate(0deg); 
                opacity: 1; 
            }
            100% { 
                transform: scale(1) rotate(0deg); 
                opacity: 1; 
            }
        }
        
        .btn-success.selected {
            background-color: #198754 !important;
            border-color: #146c43 !important;
        }
        
        .btn-warning.selected {
            background-color: #fd7e14 !important;
            border-color: #fd7e14 !important;
        }
        
        .btn-primary.selected {
            background-color: #0d6efd !important;
            border-color: #0a58ca !important;
        }

        /* ÈüøÊáâÂºèË®≠Ë®à */
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .header { padding: 30px 20px; }
            .header h1 { font-size: 2rem; }
            .grid-form { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); gap: 15px; }
            .sync-grid { grid-template-columns: 1fr; }
            
            /* ÈÅ∏ÂñÆ‰∏ÄË°åÈ°ØÁ§∫ */
            .tabs { 
                flex-wrap: nowrap; 
                overflow-x: auto; 
                -webkit-overflow-scrolling: touch;
            }
            .tab { 
                padding: 12px 15px; 
                font-size: 14px;
                white-space: nowrap;
                min-width: auto;
                flex: 1;
            }
            
            /* ÈªûÂêçÊåâÈàïÂÑ™Âåñ */
            .attendance-btn, .attendance-choice-btn { 
                padding: 8px 12px !important; 
                font-size: 14px !important;
                margin: 2px !important;
            }
            
            /* Â≠∏Âì°È†ÖÁõÆÊ©´Âêë‰ΩàÂ±Ä */
            .student-attendance-item {
                display: flex !important;
                align-items: center !important;
                justify-content: space-between !important;
                padding: 15px !important;
                margin-bottom: 10px !important;
                border-radius: 10px !important;
                background: #f8f9fa !important;
                border-left: 4px solid #007bff !important;
            }
            
            .student-info {
                flex: 1 !important;
                margin-right: 10px !important;
            }
            
            .student-name {
                font-size: 16px !important;
                font-weight: 600 !important;
                margin-bottom: 4px !important;
                color: #333 !important;
            }
            
            .student-class {
                font-size: 12px !important;
                color: #666 !important;
            }
            
            .attendance-buttons {
                display: flex !important;
                gap: 4px !important;
                flex-wrap: nowrap !important;
            }
            
            .attendance-choice-btn {
                min-width: 50px !important;
                padding: 8px 6px !important;
                font-size: 11px !important;
                border-radius: 6px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì Â≠∏Âì°ÁÆ°ÁêÜÁ≥ªÁµ±</h1>
            <div style="margin-top: 20px;">
                <span style="font-size: 16px;">Á≥ªÁµ±ÁãÄÊÖã:</span>
                <span class="status-indicator status-online" id="serverStatus"></span>
                <span id="statusText" style="font-weight: 600;">Ê≠£Â∏∏ÈÅãË°å</span>
            </div>
        </div>

        <!-- Ê®ôÁ±§È†ÅÂ∞éËà™ -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('attendance', this)">‚úÖ ÈªûÂêçÁ≥ªÁµ±</button>
            <button class="tab" onclick="showTab('students', this)">üë• Êñ∞Â¢ûÂ≠∏Âì°</button>
            <button class="tab" onclick="showTab('sync', this)">‚òÅÔ∏è Èõ≤Á´ØÂêåÊ≠•</button>
        </div>

        <!-- ÈªûÂêçÁ≥ªÁµ±Ê®ôÁ±§ -->
        <div id="attendanceTab" class="tab-content active">
            <div class="card">
                <h3 style="margin-bottom: 25px; color: #333; font-size: 24px;">‚úÖ ÈªûÂêçÁ≥ªÁµ±</h3>
                
                <div class="grid-form">
                    <div class="form-group">
                        <label>Êó•Êúü *</label>
                        <input type="date" id="attendanceDate" required>
                    </div>
                    <div class="form-group">
                        <label>Áè≠Âà• *</label>
                        <select id="attendanceClass" required onchange="loadStudentsForAttendance()">
                            <option value="">Ë´ãÈÅ∏ÊìáÁè≠Âà•</option>
                            <!-- Áè≠Âà•ÈÅ∏È†ÖÂ∞áÂæûÂ≠∏Âì°Ë≥áÊñô‰∏≠ÂãïÊÖãËºâÂÖ• -->
                        </select>
                    </div>
                </div>

                <div style="margin-top: 30px; text-align: center;">
                    <button class="btn btn-primary" onclick="startAttendance()">üöÄ ÈñãÂßãÈªûÂêç</button>
                </div>
            </div>

            <!-- ÈªûÂêçÂàóË°® -->
            <div class="card" id="attendanceListCard" style="display: none;">
                <h3 style="margin-bottom: 25px; color: #333; font-size: 24px;">üìã ÈªûÂêçÂàóË°®</h3>
                <div id="attendanceStudentsList"></div>
                <div style="margin-top: 30px; text-align: center;">
                    <button class="btn btn-success" onclick="saveAndUploadAttendance()">üíæ ÂÑ≤Â≠ò‰∏¶Ëá™Âãï‰∏äÂÇ≥ÈªûÂêçË®òÈåÑ</button>
                    <button class="btn btn-warning" onclick="resetAttendance()">üîÑ ÈáçÊñ∞ÈªûÂêç</button>
                </div>
            </div>

            <!-- ‰ªäÊó•ÈªûÂêçË®òÈåÑ -->
            <div class="card">
                <h3 style="margin-bottom: 25px; color: #333; font-size: 24px;">üìÖ ‰ªäÊó•ÈªûÂêçË®òÈåÑ</h3>
                <div class="student-list" id="todayAttendanceList">
                    <div class="empty-state">
                        <h3>üìù ÈÇÑÊ≤íÊúâ‰ªäÊó•ÁöÑÈªûÂêçË®òÈåÑ</h3>
                        <p>ÈÅ∏ÊìáÁè≠Âà•‰∏¶ÈñãÂßãÈªûÂêç</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Â≠∏Âì°ÁÆ°ÁêÜÊ®ôÁ±§ -->
        <div id="studentsTab" class="tab-content">
            <div class="card">
                <h3 style="margin-bottom: 30px; color: #333; font-size: 24px;">‚ûï Êñ∞Â¢ûÂ≠∏Âì°</h3>
                <div class="grid-form">
                    <div class="form-group">
                        <label>Â≠∏Âì°ÂßìÂêç *</label>
                        <input type="text" id="studentName" placeholder="Ë´ãËº∏ÂÖ•Â≠∏Âì°ÂßìÂêç" required>
                    </div>
                    <div class="form-group">
                        <label>Âà•Âêç/Ëã±ÊñáÂêç</label>
                        <input type="text" id="studentNickname" placeholder="Âà•ÂêçÊàñËã±ÊñáÂêç (ÈÅ∏Â°´)">
                    </div>
                    <div class="form-group">
                        <label>Áè≠Âà• *</label>
                        <select id="studentClass" required>
                            <option value="">Ë´ãÈÅ∏ÊìáÁè≠Âà•</option>
                            <!-- Áè≠Âà•ÈÅ∏È†ÖÊúÉÂãïÊÖãËºâÂÖ• -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ËÅØÁµ°ÈõªË©±</label>
                        <input type="tel" id="studentPhone" placeholder="ËÅØÁµ°ÈõªË©±">
                    </div>
                    <div class="form-group">
                        <label>ÈõªÂ≠ê‰ø°ÁÆ±</label>
                        <input type="email" id="studentEmail" placeholder="ÈõªÂ≠ê‰ø°ÁÆ±">
                    </div>
                    <div class="form-group">
                        <label>ÁîüÊó•</label>
                        <input type="date" id="studentBirthday" placeholder="ÈÅ∏ÊìáÁîüÊó•Êó•Êúü" onchange="handleBirthdayInput()">
                    </div>
                    <div class="form-group">
                        <label>Á∑äÊÄ•ËÅØÁµ°‰∫∫</label>
                        <input type="text" id="emergencyContact" placeholder="Á∑äÊÄ•ËÅØÁµ°‰∫∫ÂßìÂêç">
                    </div>
                    <div class="form-group">
                        <label>Á∑äÊÄ•ËÅØÁµ°ÈõªË©±</label>
                        <input type="tel" id="emergencyPhone" placeholder="Á∑äÊÄ•ËÅØÁµ°ÈõªË©±">
                    </div>
                </div>
                <div class="form-group">
                    <label>ÂÇôË®ª</label>
                    <textarea id="studentRemarks" placeholder="ÂÖ∂‰ªñÂÇôË®ªË≥áË®ä" rows="4"></textarea>
                </div>
                <div style="margin-top: 30px; text-align: center;">
                    <button class="btn btn-success" onclick="addStudent()">‚ûï Êñ∞Â¢ûÂ≠∏Âì°</button>
                    <button class="btn btn-primary" onclick="loadStudents()">üîÑ ÈáçÊñ∞ËºâÂÖ•</button>
                    <button class="btn btn-warning" onclick="clearForm()">üßπ Ê∏ÖÁ©∫Ë°®ÂñÆ</button>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 25px; color: #333; font-size: 24px;">üìã Â≠∏Âì°ÂàóË°®</h3>
                <div class="student-list" id="studentList">
                    <div class="empty-state">
                        <h3>üîÑ ËºâÂÖ•‰∏≠...</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- Èõ≤Á´ØÂêåÊ≠•Ê®ôÁ±§ -->
        <div id="syncTab" class="tab-content">
            <div class="card">
                <h3 style="margin-bottom: 30px; color: #333; font-size: 24px;">‚òÅÔ∏è Google Sheets ÂêåÊ≠•</h3>
                <div class="sync-grid">
                    <div class="sync-card">
                        <h4 style="color: #28a745; margin-bottom: 20px; font-size: 20px;">üì§ ‰∏äÂÇ≥Â≠∏Âì°Ë≥áÊñô</h4>
                        <button class="btn btn-success" onclick="syncToCloud()" style="width: 100%; margin-bottom: 20px;">
                            ‚òÅÔ∏è ÂêåÊ≠•Â≠∏Âì°Âà∞Èõ≤Á´Ø
                        </button>
                        <p style="font-size: 14px; color: #666; line-height: 1.6;">
                            Â∞áÊú¨Âú∞Â≠∏Âì°Ë≥áÊñô‰∏äÂÇ≥Âà∞ Google Sheets<br>
                            <strong>Ê≥®ÊÑèÔºö</strong>ÊúÉË¶ÜËìãÈõ≤Á´ØÁèæÊúâË≥áÊñô
                        </p>
                    </div>
                    <div class="sync-card">
                        <h4 style="color: #007bff; margin-bottom: 20px; font-size: 20px;">üì• ËºâÂÖ•Â≠∏Âì°Ë≥áÊñô</h4>
                        <button class="btn btn-primary" onclick="loadFromCloud()" style="width: 100%; margin-bottom: 20px;">
                            üì• ÂæûÈõ≤Á´ØËºâÂÖ•Â≠∏Âì°
                        </button>
                        <p style="font-size: 14px; color: #666; line-height: 1.6;">
                            Âæû Google Sheets ËºâÂÖ•Â≠∏Âì°Ë≥áÊñô<br>
                            <strong>Ê≥®ÊÑèÔºö</strong>ÊúÉË¶ÜËìãÊú¨Âú∞ÁèæÊúâË≥áÊñô
                        </p>
                    </div>
                    <div class="sync-card">
                        <h4 style="color: #ffc107; margin-bottom: 20px; font-size: 20px;">üìã ÈªûÂêçË®òÈåÑ</h4>
                        <button class="btn btn-warning" onclick="syncAttendanceToCloud()" style="width: 100%; margin-bottom: 10px;">
                            üöÄ Ëá™Âãï‰∏äÂÇ≥Âà∞ Google Sheets
                        </button>
                        <button class="btn btn-primary" onclick="showAttendanceRecords()" style="width: 100%; margin-bottom: 20px;">
                            üëÄ Êü•ÁúãÊú¨Âú∞Ë®òÈåÑ
                        </button>
                        <p style="font-size: 14px; color: #666; line-height: 1.6;">
                            Ëá™Âãï‰∏äÂÇ≥ÈªûÂêçË®òÈåÑÂà∞ Google Sheets<br>
                            <strong>Ë®òÈåÑÊï∏Ôºö</strong><span id="attendanceCount">0</span> Á≠Ü<br>
                            <small style="color: #e74c3c;">‚ö†Ô∏è ‰∏äÂÇ≥ÊàêÂäüÂæåÂ∞áÊ∏ÖÁ©∫Êú¨Âú∞Ë®òÈåÑ</small>
                        </p>
                    </div>
                </div>

                <div style="margin-top: 40px; padding: 25px; background: rgba(248,249,250,0.8); border-radius: 15px;">
                    <h4 style="color: #333; margin-bottom: 15px; font-size: 18px;">üìã ÂêåÊ≠•ÁãÄÊÖã</h4>
                    <p id="syncStatus" style="color: #666; font-size: 16px;">Á≥ªÁµ±Â∑≤ÂïüÂãïÔºåÊ∫ñÂÇôÂ∞±Á∑í</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ÈÄöÁü•ÂÖÉÁ¥† -->
    <div id="notification" class="notification"></div>

    <script>
        // Google Apps Script URL Ë®≠ÂÆö
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw_m3SjHokYxU-eUkFrMtcrVXnoxSGhRAfuUxYDt6P81UwmxcMrkKjz-h7A4teL8kKIjQ/exec';
        
        // Â≠∏Âì°Ë≥áÊñôÈô£Âàó
        let students = [];
        let todayAttendance = [];
        let currentAttendanceClass = '';
        let currentAttendanceDate = '';

        // ÂÖ®ÂüüËÆäÊï∏ - Áî®ÊñºËá®ÊôÇÂÑ≤Â≠òÈªûÂêçÈÅ∏Êìá
        let tempAttendanceChoices = {}; // Ê†ºÂºè: { studentId: status }

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Â≠∏Âì°ÁÆ°ÁêÜÁ≥ªÁµ±ÂïüÂãï‰∏≠...');
            showNotification('Ê≠°Ëøé‰ΩøÁî®Â≠∏Âì°ÁÆ°ÁêÜÁ≥ªÁµ±ÔºÅ', 'success');
            
            await loadStudents();
            updateClassOptions(); // ÂæûÂ≠∏Âì°Ë≥áÊñô‰∏≠Êõ¥Êñ∞Áè≠Âà•ÈÅ∏È†Ö
            await loadFromCloudSilently();
            
            // Ëá™ÂãïÂæûË™≤Á®ãË°®ËºâÂÖ•Áè≠Âà•
            try {
                await loadClassesFromSchedule();
            } catch (error) {
                console.log('üìÖ Ëá™ÂãïËºâÂÖ•Ë™≤Á®ãË°®Áè≠Âà•Â§±ÊïóÔºåÂ∞á‰ΩøÁî®Â≠∏Âì°Ë≥áÊñô‰∏≠ÁöÑÁè≠Âà•');
            }
            
            // Ë®≠ÂÆöÈ†êË®≠Êó•ÊúüÁÇ∫‰ªäÂ§©
            document.getElementById('attendanceDate').value = new Date().toISOString().split('T')[0];
            
            // Ë®≠ÁΩÆÈªûÂêçÊåâÈàï‰∫ã‰ª∂Áõ£ËÅΩÂô®
            setupAttendanceButtons();
            
            loadTodayAttendance();
        });

        // Ê®ôÁ±§È†ÅÂàáÊèõ
        function showTab(tabName, element) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            if (element) {
                element.classList.add('active');
            }
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            if (tabName === 'attendance') {
                displayTodayAttendance();
            }
        }

        // È°ØÁ§∫ÈÄöÁü•
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // ÁîüÊàê‰∏ã‰∏ÄÂÄãÂ≠∏Âì°ID (YÈñãÈ†≠ÁöÑÂ∫èËôü)
        function generateNextStudentId() {
            // ÊâæÂá∫ÊâÄÊúâÁèæÊúâÁöÑYÈñãÈ†≠ID
            const existingIds = students
                .map(s => s.id)
                .filter(id => id && id.startsWith('Y'))
                .map(id => {
                    const num = parseInt(id.substring(1));
                    return isNaN(num) ? 0 : num;
                })
                .sort((a, b) => b - a); // ÈôçÂ∫èÊéíÂàó
            
            // ÊâæÂá∫ÊúÄÂ§ßÁöÑÂ∫èËôüÔºåÁÑ∂Âæå+1
            const maxId = existingIds.length > 0 ? existingIds[0] : 0;
            const nextId = maxId + 1;
            
            // Ê†ºÂºèÂåñÁÇ∫ Y + 4‰ΩçÊï∏Â≠ó (‰æãÂ¶Ç: Y0001, Y0002...)
            const paddedId = nextId.toString().padStart(4, '0');
            const newId = `Y${paddedId}`;
            
            console.log(`üÜî ÁîüÊàêÊñ∞Â≠∏Âì°ID: ${newId} (Áï∂ÂâçÊúÄÂ§ßID: Y${maxId.toString().padStart(4, '0')})`);
            return newId;
        }

        // Ê†ºÂºèÂåñÊó•ÊúüÁÇ∫Âπ¥ÊúàÊó•
        function formatDateOnly() {
            const now = new Date();
            const year = now.getFullYear();
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Ê†ºÂºèÂåñÁîüÊó•Êó•ÊúüÈ°ØÁ§∫ (Âè™È°ØÁ§∫Êúà-Êó•)
        function formatBirthday(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const day = date.getDate();
            const month = months[date.getMonth()];
            return `${day}-${month}`;
        }

        // Êñ∞Â¢ûÂ≠∏Âì° (Áõ¥Êé•ÂêåÊ≠•Âà∞Èõ≤Á´ØÔºå‰∏ç‰ΩøÁî®Êú¨Âú∞Ë®òÊÜ∂)
        async function addStudent() {
            const name = document.getElementById('studentName').value.trim();
            const className = document.getElementById('studentClass').value.trim();
            
            if (!name) {
                showNotification('Ë´ãËº∏ÂÖ•Â≠∏Âì°ÂßìÂêç', 'error');
                return;
            }
            
            if (!className) {
                showNotification('Ë´ãÈÅ∏ÊìáÁè≠Âà•', 'error');
                return;
            }

            // Ê†ºÂºèÂåñÁîüÊó• (Âè™Ë¶ÅÊó•-ÊúàÊ†ºÂºèÔºåÂ¶Ç 5-Aug)
            const birthdayInput = document.getElementById('studentBirthday').value;
            const formattedBirthday = birthdayInput ? formatBirthday(birthdayInput) : '';

            // Ê∫ñÂÇôÂ≠∏Âì°Ë≥áÊñô (‰∏çÁîüÊàêÊú¨Âú∞IDÔºåËÆìGoogle SheetsÊ±∫ÂÆö)
            const studentData = {
                name: name,
                nickname: document.getElementById('studentNickname').value.trim(),
                class: className,
                phone: document.getElementById('studentPhone').value.trim(),
                email: document.getElementById('studentEmail').value.trim(),
                birthday: formattedBirthday,
                emergencyContact: document.getElementById('emergencyContact').value.trim(),
                emergencyPhone: document.getElementById('emergencyPhone').value.trim(),
                status: 'Âú®ËÆÄ', // È†êË®≠ÁãÄÊÖã
                remarks: document.getElementById('studentRemarks').value.trim(),
                createdAt: formatDateOnly()
            };

            showNotification('üîÑ Ê≠£Âú®Êñ∞Â¢ûÂ≠∏Âì°Âà∞Èõ≤Á´Ø...', 'info');

            try {
                // Áç≤ÂèñÁèæÊúâÂ≠∏Âì°‰æÜÁîüÊàêÊñ∞IDÔºåÁÑ∂ÂæåÂè™ÂêåÊ≠•Êñ∞Â≠∏Âì°
                const getResponse = await fetch('/api/get-students');
                let existingStudents = [];
                
                if (getResponse.ok) {
                    const getResult = await getResponse.json();
                    if (getResult.success && getResult.students) {
                        existingStudents = getResult.students;
                    }
                }

                // ÁîüÊàêÊñ∞ÁöÑÂ≠∏Âì°ID
                const maxId = existingStudents
                    .map(s => s.id)
                    .filter(id => id && id.startsWith('Y'))
                    .map(id => parseInt(id.substring(1)))
                    .filter(num => !isNaN(num))
                    .sort((a, b) => b - a)[0] || 0;
                
                const newId = `Y${(maxId + 1).toString().padStart(4, '0')}`;
                
                // Ê∑ªÂä†IDÂà∞Â≠∏Âì°Ë≥áÊñô
                studentData.id = newId;

                // ‰ΩøÁî®ÁèæÊúâÁöÑsync-students APIÔºå‰ΩÜÊîπÊàêappendÊ®°Âºè
                const response = await fetch('/api/sync-students', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'appendStudent',  // Êñ∞ÁöÑactionË°®Á§∫ËøΩÂä†ËÄå‰∏çÊòØË¶ÜËìã
                        students: [studentData]   // Âè™ÂÇ≥ÈÄÅÊñ∞Â≠∏Âì°
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(`‚úÖ Â≠∏Âì°„Äå${name}„ÄçÂ∑≤ÊàêÂäüÊñ∞Â¢û (ID: ${newId})`, 'success');
                    clearForm();
                    // ÈáçÊñ∞ËºâÂÖ•Â≠∏Âì°ÂàóË°®
                    await loadStudentsFromCloud();
                } else {
                    throw new Error(result.message || 'Êñ∞Â¢ûÂ§±Êïó');
                }
            } catch (error) {
                console.error('Êñ∞Â¢ûÂ≠∏Âì°ÈåØË™§:', error);
                showNotification('‚ùå Êñ∞Â¢ûÂ≠∏Âì°Â§±ÊïóÔºö' + error.message, 'error');
                
                // ÂÇôÁî®ÔºöË§áË£ΩÂà∞Ââ™Ë≤ºÁ∞ø (ÂåÖÂê´Ê≠£Á¢∫ÁöÑÊ¨Ñ‰ΩçÈ†ÜÂ∫è)
                const csvData = `${studentData.id}\t${studentData.name}\t${studentData.nickname}\t${studentData.class}\t${studentData.phone}\t${studentData.email}\t${studentData.birthday}\t${studentData.emergencyContact}\t${studentData.emergencyPhone}\t${studentData.status}\t${studentData.remarks}\t${studentData.createdAt}`;
                
                try {
                    await navigator.clipboard.writeText(csvData);
                    showNotification('üìã Â∑≤Ë§áË£ΩÂ≠∏Âì°Ë≥áÊñôÂà∞Ââ™Ë≤ºÁ∞øÔºåË´ãÊâãÂãïË≤º‰∏äÂà∞ Google Sheets Êñ∞Ë°å', 'info', 8000);
                } catch (clipError) {
                    console.error('Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞øÂ§±Êïó:', clipError);
                }
            }
        }

        // Ê∏ÖÁ©∫Ë°®ÂñÆ
        function clearForm() {
            document.getElementById('studentName').value = '';
            document.getElementById('studentNickname').value = '';
            document.getElementById('studentClass').value = '';
            document.getElementById('studentPhone').value = '';
            document.getElementById('studentEmail').value = '';
            document.getElementById('studentBirthday').value = '';
            document.getElementById('emergencyContact').value = '';
            document.getElementById('emergencyPhone').value = '';
            document.getElementById('studentRemarks').value = '';
        }

        // ËºâÂÖ•Â≠∏Âì°Ë≥áÊñô (Â∑≤ÊîπÁÇ∫ÂæûÈõ≤Á´ØËºâÂÖ•ÔºåË¶ã loadStudentsFromCloud ÂáΩÊï∏)
        // Ê≠§ÂáΩÊï∏Â∑≤ÂÅúÁî®ÔºåË´ã‰ΩøÁî® loadStudentsFromCloud()
        async function loadStudents() {
            console.log('‚ö†Ô∏è loadStudents Â∑≤ÂÅúÁî®ÔºåË´ã‰ΩøÁî® loadStudentsFromCloud()');
            await loadStudentsFromCloud();
        }

        // È°ØÁ§∫Â≠∏Âì°ÂàóË°®
        function displayStudents() {
            const list = document.getElementById('studentList');
            
            if (students.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <h3>üìö ÈÇÑÊ≤íÊúâÂ≠∏Âì°Ë≥áÊñô</h3>
                        <p>ÈªûÊìä‰∏äÊñπÁöÑ„ÄåÊñ∞Â¢ûÂ≠∏Âì°„ÄçÊåâÈàïÈñãÂßãÂª∫Á´ã‰Ω†ÁöÑÂ≠∏Âì°ÂêçÂÜä<br>
                        ÊâÄÊúâË≥áÊñôÊúÉÂÆâÂÖ®Âú∞ÂÑ≤Â≠òÂú®‰Ω†ÁöÑÁÄèË¶ΩÂô®‰∏≠</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = students.map(student => `
                <div class="student-item">
                    <div>
                        <div style="font-size: 20px; font-weight: 700; margin-bottom: 8px; color: #333;">
                            ${student.name}
                            ${student.nickname ? `<span style="color: #666; font-weight: 400; font-size: 16px;">(${student.nickname})</span>` : ''}
                            <span style="color: #999; font-weight: 400; font-size: 14px; margin-left: 10px;">ID: ${student.id}</span>
                        </div>
                        <div style="color: #666; font-size: 15px; margin-bottom: 5px;">
                            <span style="margin-right: 20px; background: #e3f2fd; padding: 4px 12px; border-radius: 20px; color: #1976d2;">
                                üìö ${student.class || 'Êú™ÂàÜÈÖçÁè≠Âà•'}
                            </span>
                            <span style="color: ${getStatusColor(student.status)}; font-weight: 600;">
                                ‚óè ${student.status}
                            </span>
                        </div>
                        <div style="color: #999; font-size: 13px; line-height: 1.4;">
                            üìÖ ${student.createdAt} Âª∫Á´ã
                            ${student.phone ? ` | üìû ${student.phone}` : ''}
                            ${student.email ? ` | üìß ${student.email}` : ''}
                            ${student.birthday ? ` | üéÇ ${student.birthday}` : ''}
                        </div>
                        ${student.emergencyContact || student.emergencyPhone ? `
                            <div style="color: #e74c3c; font-size: 12px; margin-top: 4px;">
                                üö® Á∑äÊÄ•ËÅØÁµ°: ${student.emergencyContact || ''}${student.emergencyPhone ? ` (${student.emergencyPhone})` : ''}
                            </div>
                        ` : ''}
                    </div>
                    <div>
                        <button class="btn btn-danger" onclick="deleteStudent('${student.id}')" 
                                title="Âà™Èô§Â≠∏Âì°" style="padding: 10px 15px;">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ÂèñÂæóÁãÄÊÖãÈ°èËâ≤
        function getStatusColor(status) {
            switch (status) {
                case 'Âú®ËÆÄ': return '#28a745';
                case '‰ºëÂ≠∏': return '#ffc107';
                case 'Áï¢Ê•≠': return '#6c757d';
                case 'ÈÄÄÂ≠∏': return '#dc3545';
                default: return '#007bff';
            }
        }

        // Âà™Èô§Â≠∏Âì°
        function deleteStudent(id) {
            const student = students.find(s => s.id === id);
            if (!student) return;
            
            if (confirm(`‚ö†Ô∏è Á¢∫ÂÆöË¶ÅÂà™Èô§Â≠∏Âì°„Äå${student.name}„ÄçÂóéÔºü\n\nÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©ÂéüÔºåË´ãË¨πÊÖéËÄÉÊÖÆ„ÄÇ`)) {
                students = students.filter(s => s.id !== id);
                localStorage.setItem('studentData', JSON.stringify(students));
                displayStudents();
                updateClassOptions(); // Êõ¥Êñ∞Áè≠Âà•ÈÅ∏È†Ö
                updateStatistics();
                showNotification(`üóëÔ∏è Â≠∏Âì°„Äå${student.name}„ÄçÂ∑≤Âà™Èô§`, 'warning');
            }
        }

        // Êõ¥Êñ∞Áè≠Âà•ÈÅ∏È†Ö - ÂæûÁèæÊúâÂ≠∏Âì°Ë≥áÊñô‰∏≠ÊèêÂèñ
        function updateClassOptions() {
            // ÂæûÂ≠∏Âì°Ë≥áÊñô‰∏≠ÊèêÂèñÊâÄÊúâÁè≠Âà•
            const classNames = [...new Set(students.map(s => s.class).filter(c => c && c.trim()))];
            
            // Êõ¥Êñ∞Êñ∞Â¢ûÂ≠∏Âì°ÁöÑ select
            const selectElement = document.getElementById('studentClass');
            if (selectElement) {
                const currentValue = selectElement.value;
                selectElement.innerHTML = '<option value="">Ë´ãÈÅ∏ÊìáÁè≠Âà•</option>' +
                    classNames.map(className => `<option value="${className}">${className}</option>`).join('');
                
                // ÊÅ¢Âæ©‰πãÂâçÈÅ∏ÊìáÁöÑÂÄº
                if (currentValue && classNames.includes(currentValue)) {
                    selectElement.value = currentValue;
                }
            }
            
            // Êõ¥Êñ∞ÈªûÂêçÁ≥ªÁµ±ÁöÑ select (Â¶ÇÊûúÂ≠òÂú®)
            const attendanceSelect = document.getElementById('attendanceClass');
            if (attendanceSelect) {
                const currentValue = attendanceSelect.value;
                attendanceSelect.innerHTML = '<option value="">Ë´ãÈÅ∏ÊìáÁè≠Âà•</option>' +
                    classNames.map(className => `<option value="${className}">${className}</option>`).join('');
                
                // ÊÅ¢Âæ©‰πãÂâçÈÅ∏ÊìáÁöÑÂÄº
                if (currentValue && classNames.includes(currentValue)) {
                    attendanceSelect.value = currentValue;
                }
            }
            
            console.log(`üìö Êõ¥Êñ∞Áè≠Âà•ÈÅ∏È†Ö: ${classNames.join(', ')}`);
        }

        // ÂæûË™≤Á®ãË°®ËºâÂÖ•Áè≠Âà•
        async function loadClassesFromSchedule() {
            try {
                showNotification('Ê≠£Âú®ÂæûË™≤Á®ãË°®ËºâÂÖ•Áè≠Âà•...', 'warning');
                
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL + '?action=getSchedule', {
                    method: 'GET',
                    redirect: 'follow'
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                console.log('üìÖ Ë™≤Á®ãË°®ÂõûÊáâ:', result);

                if (result.success && result.schedule) {
                    const classSelect = document.getElementById('studentClass');
                    const attendanceClassSelect = document.getElementById('attendanceClass');
                    
                    // Ê∏ÖÁ©∫ÁèæÊúâÈÅ∏È†Ö
                    classSelect.innerHTML = '<option value="">Ë´ãÈÅ∏ÊìáÁè≠Âà•</option>';
                    if (attendanceClassSelect) {
                        attendanceClassSelect.innerHTML = '<option value="">Ë´ãÈÅ∏ÊìáÁè≠Âà•</option>';
                    }

                    // ÂæûË™≤Á®ãË°®‰∏≠ÊèêÂèñÂîØ‰∏ÄÁöÑÁè≠Âà• (‰∏ªË¶ÅÂæû class_id Ê¨Ñ‰Ωç)
                    const classes = new Set();
                    
                    result.schedule.forEach(scheduleItem => {
                        // ÂÑ™ÂÖàÊ™¢Êü• class_id Ê¨Ñ‰ΩçÔºåÁÑ∂ÂæåÊòØÂÖ∂‰ªñÂèØËÉΩÁöÑÁè≠Âà•Ê¨Ñ‰Ωç
                        const possibleFields = ['class_id', 'name', 'className', 'class', 'Áè≠Âà•', 'Class', 'class_name'];
                        
                        for (const field of possibleFields) {
                            if (scheduleItem[field] && typeof scheduleItem[field] === 'string') {
                                const className = scheduleItem[field].trim();
                                if (className && className !== '') {
                                    classes.add(className);
                                    console.log(`üìã Âæû ${field} Ê¨Ñ‰ΩçÊâæÂà∞Áè≠Âà•: ${className}`);
                                    break; // ÊâæÂà∞ÂæåË∑≥Âá∫Âæ™Áí∞
                                }
                            }
                        }
                    });

                    // Ê∑ªÂä†Áè≠Âà•ÈÅ∏È†Ö
                    classes.forEach(className => {
                        const option = new Option(className, className);
                        classSelect.appendChild(option.cloneNode(true));
                        
                        if (attendanceClassSelect) {
                            attendanceClassSelect.appendChild(option);
                        }
                    });

                    if (classes.size > 0) {
                        showNotification(`‚úÖ ÊàêÂäüËºâÂÖ• ${classes.size} ÂÄãÁè≠Âà•`, 'success');
                    } else {
                        showNotification('‚ö†Ô∏è Ë™≤Á®ãË°®‰∏≠Ê≤íÊúâÊâæÂà∞Áè≠Âà•Ë≥áË®ä', 'warning');
                    }
                } else {
                    throw new Error(result.message || 'ËºâÂÖ•Ë™≤Á®ãË°®Â§±Êïó');
                }
            } catch (error) {
                console.error('ËºâÂÖ•Ë™≤Á®ãË°®ÈåØË™§:', error);
                showNotification(`‚ùå ËºâÂÖ•Ë™≤Á®ãË°®Â§±Êïó: ${error.message}`, 'error');
            }
        }

        // ÂêåÊ≠•Âà∞Èõ≤Á´Ø
        async function syncToCloud() {
            if (students.length === 0) {
                showNotification('Ê≤íÊúâÂ≠∏Âì°Ë≥áÊñôÈúÄË¶ÅÂêåÊ≠•', 'warning');
                return;
            }

            showNotification('üîÑ Ê≠£Âú®ÂêåÊ≠•Âà∞Èõ≤Á´Ø...', 'info');

            // Ê∫ñÂÇôÂ≠∏Âì°Ë≥áÊñô
            const data = students.map(student => ({
                id: student.id || '',
                name: student.name || '',
                nickname: student.nickname || '',
                class: student.class || '',
                phone: student.phone || '',
                email: student.email || '',
                birthday: student.birthday || '',
                emergency_contact: student.emergencyContact || '',  // Á¢∫‰øùÊ¨Ñ‰ΩçÂêçÁ®±Â∞çÊáâ
                emergency_phone: student.emergencyPhone || '',      // Á¢∫‰øùÊ¨Ñ‰ΩçÂêçÁ®±Â∞çÊáâ
                status: student.status || '',
                remarks: student.remarks || '',
                createdAt: student.createdAt || ''
            }));

            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ students: data })
                });

                if (!response.ok) throw new Error('Network response was not ok');
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(`‚úÖ ÊàêÂäüÂêåÊ≠• ${data.length} Á≠ÜÂ≠∏Âì°Ë≥áÊñôÂà∞Èõ≤Á´Ø`, 'success');
                } else {
                    throw new Error(result.message || 'ÂêåÊ≠•Â§±Êïó');
                }
            } catch (error) {
                console.error('Sync error:', error);
                showNotification('‚ùå ÂêåÊ≠•Â§±ÊïóÔºö' + error.message, 'error');
                
                // È°ØÁ§∫ÊâãÂãïË§áË£ΩÈÅ∏È†Ö
                const csvData = data.map(s => 
                    `${s.id}\t${s.name}\t${s.nickname}\t${s.class}\t${s.phone}\t${s.email}\t${s.birthday}\t${s.emergency_contact}\t${s.emergency_phone}\t${s.status}\t${s.remarks}\t${s.createdAt}`
                ).join('\n');
                
                navigator.clipboard.writeText(csvData);
                showNotification('üìã Â∑≤Ë§áË£ΩË≥áÊñôÂà∞Ââ™Ë≤ºÁ∞øÔºåË´ãÊâãÂãïË≤º‰∏äÂà∞ Google Sheets', 'info', 8000);
            }
        }

        // ÈùúÈªòÂêåÊ≠•Âà∞Èõ≤Á´Ø
        async function syncToCloudSilently() {
            if (students.length === 0) return;
            try {
                const isVercel = window.location.hostname.includes('vercel.app');
                const apiUrl = isVercel ? '/api/sync-students' : window.location.origin + '/api/sync-students';
                
                // Á¢∫‰øùÂ≠∏Âì°Ë≥áÊñôÂåÖÂê´ÊâÄÊúâÂøÖË¶ÅÊ¨Ñ‰Ωç
                const studentsWithAllFields = students.map(student => ({
                    id: student.id || '',
                    name: student.name || '',
                    nickname: student.nickname || '',
                    class: student.class || '',
                    phone: student.phone || '',
                    email: student.email || '',
                    birthday: student.birthday || '',
                    emergencyContact: student.emergencyContact || '',
                    emergencyPhone: student.emergencyPhone || '',
                    status: student.status || '',
                    remarks: student.remarks || '',
                    createdAt: student.createdAt || ''
                }));
                
                await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ students: studentsWithAllFields })
                });
                console.log(`üîÑ Ëá™ÂãïÂêåÊ≠• ${students.length} Á≠ÜÂ≠∏Âì°Ë≥áÊñôÂà∞Èõ≤Á´Ø (ÂåÖÂê´Á∑äÊÄ•ËÅØÁµ°Ë≥áË®ä)`);
            } catch (error) {
                console.log('üîÑ Ëá™ÂãïÂêåÊ≠•Â§±Êïó:', error);
            }
        }

        // ÂæûÈõ≤Á´ØËºâÂÖ•
        async function loadFromCloud() {
            try {
                showNotification('Ê≠£Âú®ÂæûÈõ≤Á´ØËºâÂÖ•...', 'warning');
                document.getElementById('syncStatus').textContent = 'Ê≠£Âú®Âæû Google Sheets ËºâÂÖ•Ë≥áÊñô...';
                
                const isVercel = window.location.hostname.includes('vercel.app');
                const apiUrl = isVercel ? '/api/get-students' : window.location.origin + '/api/get-students';
                
                const response = await fetch(apiUrl);
                const result = await response.json();
                
                if (result.success && result.students) {
                    students = result.students;
                    localStorage.setItem('studentData', JSON.stringify(students));
                    displayStudents();
                    updateClassOptions();
                    updateStatistics();
                    showNotification(`‚úÖ ÊàêÂäüËºâÂÖ• ${result.count} Á≠ÜÂ≠∏Âì°Ë≥áÊñô`, 'success');
                    document.getElementById('syncStatus').textContent = `‚úÖ ÊàêÂäüËºâÂÖ• ${result.count} Á≠ÜË≥áÊñô (${new Date().toLocaleString('zh-TW')})`;
                } else {
                    throw new Error(result.error || 'ËºâÂÖ•Â§±Êïó');
                }
            } catch (error) {
                console.error('ËºâÂÖ•Â§±Êïó:', error);
                showNotification('‚ùå ËºâÂÖ•Â§±Êïó: ' + error.message, 'error');
                document.getElementById('syncStatus').textContent = `‚ùå ËºâÂÖ•Â§±Êïó: ${error.message}`;
            }
        }

        // ÈùúÈªòÂæûÈõ≤Á´ØËºâÂÖ•
        async function loadFromCloudSilently() {
            try {
                const isVercel = window.location.hostname.includes('vercel.app');
                const apiUrl = isVercel ? '/api/get-students' : window.location.origin + '/api/get-students';
                
                const response = await fetch(apiUrl);
                const result = await response.json();
                
                if (result.success && result.students && result.students.length > 0) {
                    if (result.students.length >= students.length) {
                        students = result.students;
                        localStorage.setItem('studentData', JSON.stringify(students));
                        displayStudents();
                        updateClassOptions();
                        console.log(`üîÑ Ëá™ÂãïËºâÂÖ• ${result.count} Á≠ÜÈõ≤Á´ØÂ≠∏Âì°Ë≥áÊñô`);
                    }
                }
            } catch (error) {
                console.log('üì± ‰ΩøÁî®Êú¨Âú∞Ê®°Âºè');
            }
        }

        // Êõ¥Êñ∞Áµ±Ë®à
        function updateStatistics() {
            const total = students.length;
            const active = students.filter(s => s.status === 'Âú®ËÆÄ').length;
            const suspended = students.filter(s => s.status === '‰ºëÂ≠∏').length;
            const graduated = students.filter(s => s.status === 'Áï¢Ê•≠').length;

            // Â¶ÇÊûúÊúâÁµ±Ë®àÂÖÉÁ¥†ÊâçÊõ¥Êñ∞
            const totalElement = document.getElementById('totalStudents');
            if (totalElement) {
                totalElement.textContent = total;
                document.getElementById('activeStudents').textContent = active;
                document.getElementById('suspendedStudents').textContent = suspended;
                document.getElementById('graduatedStudents').textContent = graduated;
            }
        }

        // ÈñãÂßãÈªûÂêç
        function startAttendance() {
            const date = document.getElementById('attendanceDate').value;
            const className = document.getElementById('attendanceClass').value;
            
            console.log('=== ÈñãÂßãÈªûÂêç ===');
            console.log('ÈÅ∏ÊìáÊó•Êúü:', date);
            console.log('ÈÅ∏ÊìáÁè≠Âà•:', className);
            
            if (!date || !className) {
                showNotification('Ë´ãÈÅ∏ÊìáÊó•ÊúüÂíåÁè≠Âà•', 'error');
                console.log('‚ùå Êó•ÊúüÊàñÁè≠Âà•Êú™ÈÅ∏Êìá');
                return;
            }
            
            currentAttendanceDate = date;
            currentAttendanceClass = className;
            
            console.log('‚úÖ Ë®≠ÂÆöÂÖ®ÂüüËÆäÊï∏:');
            console.log('- currentAttendanceDate:', currentAttendanceDate);
            console.log('- currentAttendanceClass:', currentAttendanceClass);
            
            // Áç≤ÂèñË©≤Áè≠Âà•ÁöÑÂ≠∏Âì°Ôºå‰∏¶‰∏îÂè™ÁØ©ÈÅ∏„ÄåÂú®ËÆÄ„ÄçÁãÄÊÖãÁöÑÂ≠∏Âì°
            const allClassStudents = students.filter(s => s.class === className);
            const activeStudents = allClassStudents.filter(s => s.status === 'Âú®ËÆÄ');
            
            console.log(`üìö ${className} Á∏ΩÂ≠∏Âì°Êï∏:`, allClassStudents.length);
            console.log(`‚úÖ ${className} Âú®ËÆÄÂ≠∏Âì°Êï∏:`, activeStudents.length);
            console.log('Âú®ËÆÄÂ≠∏Âì°ÂêçÂñÆ:', activeStudents.map(s => s.name));
            
            if (allClassStudents.length === 0) {
                showNotification(`${className} Ê≤íÊúâÂ≠∏Âì°Ë≥áÊñô`, 'warning');
                console.log('‚ùå Ë©≤Áè≠Âà•Ê≤íÊúâÂ≠∏Âì°');
                return;
            }
            
            if (activeStudents.length === 0) {
                showNotification(`${className} Ê≤íÊúâ„ÄåÂú®ËÆÄ„ÄçÁãÄÊÖãÁöÑÂ≠∏Âì°`, 'warning');
                console.log('‚ùå Ë©≤Áè≠Âà•Ê≤íÊúâÂú®ËÆÄÂ≠∏Âì°');
                return;
            }
            
            console.log(`‚úÖ ÊâæÂà∞ ${activeStudents.length} ‰ΩçÂú®ËÆÄÂ≠∏Âì°`);
            
            // È°ØÁ§∫ÈªûÂêçÂàóË°®ÔºàÂè™È°ØÁ§∫Âú®ËÆÄÂ≠∏Âì°Ôºâ
            displayAttendanceList(activeStudents);
            document.getElementById('attendanceListCard').style.display = 'block';
            
            // Ë®≠ÁΩÆÈªûÂêçÊåâÈàï‰∫ã‰ª∂Áõ£ËÅΩÂô®
            setupAttendanceButtons();
            
            showNotification(`ÈñãÂßã ${className} ÁöÑÈªûÂêç (${activeStudents.length} ‰ΩçÂú®ËÆÄÂ≠∏Âì°)`, 'success');
            console.log('‚úÖ ÈªûÂêçÂàóË°®Â∑≤È°ØÁ§∫ÔºàÂÉÖÂú®ËÆÄÂ≠∏Âì°Ôºâ');
        }
        
        // È°ØÁ§∫ÈªûÂêçÂàóË°®
        function displayAttendanceList(classStudents) {
            const container = document.getElementById('attendanceStudentsList');
            
            // Ê∏ÖÁ©∫Ëá®ÊôÇÈÅ∏Êìá
            tempAttendanceChoices = {};
            
            container.innerHTML = classStudents.map(student => `
                <div class="student-attendance-item">
                    <div class="student-info">
                        <div class="student-name">
                            ${student.name}
                            ${student.nickname ? `<span style="color: #999; font-size: 14px;">(${student.nickname})</span>` : ''}
                        </div>
                        <div class="student-class">
                            Áè≠Âà•: ${student.class}
                        </div>
                    </div>
                    <div class="attendance-buttons">
                        <button class="attendance-choice-btn btn btn-success" 
                                onclick="selectAttendanceStatus('${student.id}', 'Âá∫Â∏≠', this)"
                                data-student-id="${student.id}" 
                                data-status="Âá∫Â∏≠" 
                                title="Âá∫Â∏≠">
                            ‚úÖ
                        </button>
                        <button class="attendance-choice-btn btn btn-warning" 
                                onclick="selectAttendanceStatus('${student.id}', 'Ë´ãÂÅá', this)"
                                data-student-id="${student.id}" 
                                data-status="Ë´ãÂÅá" 
                                title="Ë´ãÂÅá">
                            üè•
                        </button>
                        <button class="attendance-choice-btn btn btn-primary" 
                                onclick="selectAttendanceStatus('${student.id}', 'ÈÅ≤Âà∞', this)"
                                data-student-id="${student.id}" 
                                data-status="ÈÅ≤Âà∞" 
                                title="ÈÅ≤Âà∞">
                            ‚è∞
                        </button>
                    </div>
                </div>
            `).join('');
            
            console.log('‚úÖ ÈªûÂêçÂàóË°®Â∑≤ÁîüÊàêÔºàÊâãÊ©üÂèãÂ•Ω‰ΩàÂ±ÄÔºâ');
            console.log('Â≠∏Âì°ÂàóË°®:', classStudents.map(s => ({ id: s.id, name: s.name })));
        }

        // ÈÅ∏ÊìáÂá∫Â∏≠ÁãÄÊÖãÔºàÂè™Êõ¥Êñ∞ÁïåÈù¢Ôºå‰∏çÁ´ãÂç≥ÂÑ≤Â≠òÔºâ
        function selectAttendanceStatus(studentId, status, clickedButton) {
            console.log('=== ÈÅ∏ÊìáÂá∫Â∏≠ÁãÄÊÖã ===');
            console.log('Â≠∏Âì°ID:', studentId);
            console.log('ÈÅ∏ÊìáÁãÄÊÖã:', status);
            
            // Ë®òÈåÑËá®ÊôÇÈÅ∏Êìá
            tempAttendanceChoices[studentId] = status;
            console.log('ÁõÆÂâçËá®ÊôÇÈÅ∏Êìá:', tempAttendanceChoices);
            
            // Êõ¥Êñ∞Ë©≤Â≠∏Âì°ÁöÑÊåâÈàïË¶ñË¶∫ÁãÄÊÖã
            const studentButtons = document.querySelectorAll(`button[data-student-id="${studentId}"]`);
            
            // ÈáçÁΩÆÊâÄÊúâÊåâÈàï
            studentButtons.forEach(btn => {
                btn.classList.remove('selected');
                btn.style.backgroundColor = '';
                btn.style.borderColor = '';
                btn.style.transform = 'scale(1)';
                btn.style.boxShadow = '';
            });
            
            // Ë®≠ÂÆöÈÅ∏‰∏≠ÊåâÈàïÁöÑÊ®£Âºè
            if (clickedButton) {
                clickedButton.classList.add('selected');
                clickedButton.style.transform = 'scale(0.9)';
                clickedButton.style.boxShadow = '0 0 0 3px rgba(13, 110, 253, 0.25)';
                
                // Ê†πÊìöÁãÄÊÖãË®≠ÂÆöÈ°èËâ≤
                switch(status) {
                    case 'Âá∫Â∏≠':
                        clickedButton.style.backgroundColor = '#198754';
                        clickedButton.style.borderColor = '#146c43';
                        break;
                    case 'Ë´ãÂÅá':
                        clickedButton.style.backgroundColor = '#fd7e14';
                        clickedButton.style.borderColor = '#fd7e14';
                        break;
                    case 'ÈÅ≤Âà∞':
                        clickedButton.style.backgroundColor = '#0d6efd';
                        clickedButton.style.borderColor = '#0a58ca';
                        break;
                }
            }
            
            // ÊâæÂà∞Â≠∏Âì°Ë≥áÊñôÈ°ØÁ§∫ÂßìÂêç
            const student = students.find(s => s.id === studentId);
            const studentName = student ? student.name : `Â≠∏Âì°${studentId}`;
            
            showNotification(`${studentName}: ${status}`, 'success');
            
            // Êõ¥Êñ∞ÂÑ≤Â≠òÊåâÈàïÁãÄÊÖã
            updateSaveButtonStatus();
        }

        // Êõ¥Êñ∞ÂÑ≤Â≠òÊåâÈàïÁãÄÊÖã
        function updateSaveButtonStatus() {
            const totalStudents = document.querySelectorAll('[data-student-id]').length / 3; // ÊØèÂÄãÂ≠∏Âì°Êúâ3ÂÄãÊåâÈàï
            const selectedCount = Object.keys(tempAttendanceChoices).length;
            
            console.log(`Â∑≤ÈÅ∏Êìá ${selectedCount}/${totalStudents} ‰ΩçÂ≠∏Âì°`);
            
            // ÈÄôË£°ÂèØ‰ª•Ê∑ªÂä†Ë¶ñË¶∫ÊèêÁ§∫ÔºåÊØîÂ¶ÇÈ°ØÁ§∫ÈÄ≤Â∫¶
            if (selectedCount === totalStudents && totalStudents > 0) {
                showNotification(`‚úÖ Â∑≤ÁÇ∫ÊâÄÊúâ ${totalStudents} ‰ΩçÂ≠∏Âì°ÈÅ∏ÊìáÁãÄÊÖãÔºåÂèØ‰ª•ÂÑ≤Â≠ò‰∫ÜÔºÅ`, 'success');
            }
        }
        
        // Ë®≠ÁΩÆÈªûÂêçÊåâÈàï‰∫ã‰ª∂Áõ£ËÅΩÂô® - ÁèæÂú®ÊîπÁî® onclickÔºåÈÄôÂÄãÂáΩÊï∏‰øùÁïô‰ΩÜÁ∞°Âåñ
        function setupAttendanceButtons() {
            console.log('‚úÖ ÈªûÂêçÊåâÈàï‰ΩøÁî®Áõ¥Êé• onclick ‰∫ã‰ª∂ÔºåÁÑ°ÈúÄÈ°çÂ§ñË®≠ÁΩÆ');
        }

        // ÂÑ≤Â≠òÈªûÂêçË®òÈåÑ - Â∞áËá®ÊôÇÈÅ∏ÊìáËΩâÁÇ∫Ê≠£ÂºèË®òÈåÑ
        async function saveAttendance() {
            console.log('=== ÈñãÂßãÂÑ≤Â≠òÈªûÂêçË®òÈåÑ ===');
            console.log('Ëá®ÊôÇÈÅ∏Êìá:', tempAttendanceChoices);
            console.log('Áï∂ÂâçÊó•Êúü:', currentAttendanceDate);
            console.log('Áï∂ÂâçÁè≠Âà•:', currentAttendanceClass);
            
            // Ê™¢Êü•ÊòØÂê¶ÊúâÈÅ∏Êìá
            if (Object.keys(tempAttendanceChoices).length === 0) {
                showNotification('Ë´ãÂÖàÁÇ∫Â≠∏Âì°ÈÅ∏ÊìáÂá∫Â∏≠ÁãÄÊÖã', 'warning');
                console.log('‚ùå Ê≤íÊúâ‰ªª‰ΩïÈÅ∏Êìá');
                return;
            }
            
            // Ê™¢Êü•ÂøÖË¶ÅËÆäÊï∏
            if (!currentAttendanceDate || !currentAttendanceClass) {
                showNotification('Áº∫Â∞ëÊó•ÊúüÊàñÁè≠Âà•Ë≥áË®äÔºåË´ãÈáçÊñ∞ÈñãÂßãÈªûÂêç', 'error');
                console.log('‚ùå Áº∫Â∞ëÂøÖË¶ÅËÆäÊï∏');
                return;
            }
            
            try {
                // Ê∏ÖÈô§Ë©≤Êó•ÊúüË©≤Áè≠Âà•ÁöÑËàäË®òÈåÑ
                const originalLength = todayAttendance.length;
                todayAttendance = todayAttendance.filter(att => 
                    !(att.date === currentAttendanceDate && att.className === currentAttendanceClass)
                );
                
                if (todayAttendance.length < originalLength) {
                    console.log(`üóëÔ∏è Ê∏ÖÈô§‰∫Ü ${originalLength - todayAttendance.length} Á≠ÜËàäË®òÈåÑ`);
                }
                
                // Â∞áËá®ÊôÇÈÅ∏ÊìáËΩâÁÇ∫Ê≠£ÂºèË®òÈåÑ
                const newRecords = [];
                for (const [studentId, status] of Object.entries(tempAttendanceChoices)) {
                    const student = students.find(s => s.id === studentId);
                    const studentName = student ? student.name : `Êú™Áü•Â≠∏Âì°(${studentId})`;
                    
                    const record = {
                        id: 'ATT_' + Date.now() + '_' + studentId,
                        date: currentAttendanceDate,
                        className: currentAttendanceClass,
                        studentId: studentId,
                        studentName: studentName,
                        status: status,
                        createdAt: new Date().toLocaleString('zh-TW')
                    };
                    
                    newRecords.push(record);
                    todayAttendance.push(record);
                }
                
                console.log('‚úÖ Êñ∞Â¢ûÁöÑË®òÈåÑ:', newRecords);
                console.log('ÁõÆÂâçÁ∏ΩË®òÈåÑÊï∏:', todayAttendance.length);
                
                // ÂÑ≤Â≠òÂà∞Êú¨Âú∞
                localStorage.setItem('todayAttendance', JSON.stringify(todayAttendance));
                console.log('‚úÖ Â∑≤ÂÑ≤Â≠òÂà∞ localStorage');
                
                // È©óË≠âÂÑ≤Â≠ò
                const savedData = localStorage.getItem('todayAttendance');
                const parsedData = JSON.parse(savedData);
                console.log('‚úÖ È©óË≠âÂÑ≤Â≠òÊàêÂäüÔºåÁ∏ΩË®òÈåÑÊï∏:', parsedData.length);
                
                // Ê∏ÖÁ©∫Ëá®ÊôÇÈÅ∏Êìá
                tempAttendanceChoices = {};
                
                // Êõ¥Êñ∞È°ØÁ§∫
                displayTodayAttendance();
                updateAttendanceCount();
                
                // È°ØÁ§∫ÊàêÂäüË®äÊÅØ
                showNotification(`‚úÖ Â∑≤ÂÑ≤Â≠ò ${newRecords.length} Á≠ÜÈªûÂêçË®òÈåÑ`, 'success');
                console.log(`‚úÖ ÂÑ≤Â≠òÂÆåÊàêÔºåÊñ∞Â¢û ${newRecords.length} Á≠ÜË®òÈåÑ`);
                
                // Èö±ËóèÈªûÂêçÂàóË°®
                document.getElementById('attendanceListCard').style.display = 'none';
                
            } catch (error) {
                console.error('‚ùå ÂÑ≤Â≠òÂ§±Êïó:', error);
                showNotification('‚ùå ÂÑ≤Â≠òÂ§±Êïó: ' + error.message, 'error');
            }
        }
        
        // ÈáçÊñ∞ÈªûÂêç
        function resetAttendance() {
            if (confirm('Á¢∫ÂÆöË¶ÅÈáçÊñ∞ÈªûÂêçÂóéÔºüÈÄôÊúÉÊ∏ÖÈô§ÁõÆÂâçÁöÑÈªûÂêçÁãÄÊÖã„ÄÇ')) {
                // Ê∏ÖÈô§‰ªäÊó•Ë©≤Áè≠Âà•ÁöÑË®òÈåÑ
                todayAttendance = todayAttendance.filter(att => 
                    !(att.date === currentAttendanceDate && att.className === currentAttendanceClass)
                );
                
                // ÈáçÊñ∞ÈñãÂßãÈªûÂêç
                startAttendance();
                showNotification('Â∑≤ÈáçÊñ∞ÈñãÂßãÈªûÂêç', 'success');
            }
        }
        
        // ËºâÂÖ•‰ªäÊó•Âá∫Â∏≠Ë®òÈåÑ
        function loadTodayAttendance() {
            const saved = localStorage.getItem('todayAttendance');
            if (saved) {
                todayAttendance = JSON.parse(saved);
            }
            displayTodayAttendance();
            updateAttendanceCount();
        }

        // Êõ¥Êñ∞ÈªûÂêçË®òÈåÑÊï∏Èáè
        function updateAttendanceCount() {
            const countElement = document.getElementById('attendanceCount');
            if (countElement) {
                countElement.textContent = todayAttendance.length;
            }
        }

        // È°ØÁ§∫ÈªûÂêçË®òÈåÑ
        function showAttendanceRecords() {
            if (todayAttendance.length === 0) {
                showNotification('Ê≤íÊúâÈªûÂêçË®òÈåÑ', 'warning');
                return;
            }
            
            let recordsText = 'üìã Êú¨Âú∞ÈªûÂêçË®òÈåÑÔºö\n\n';
            todayAttendance.forEach(record => {
                recordsText += `üìÖ ${record.date} | üìö ${record.className}\n`;
                recordsText += `üë§ ${record.studentName} (ID: ${record.studentId}) - ${record.status}\n`;
                recordsText += `‚è∞ ${record.createdAt}\n\n`;
            });
            
            alert(recordsText);
        }

        // ÂêåÊ≠•ÈªûÂêçË®òÈåÑÂà∞Èõ≤Á´ØÔºàËá™Âãï‰∏äÂÇ≥Áâà + Ê∏ÖÁ©∫Ê©üÂà∂Ôºâ
        async function syncAttendanceToCloud() {
            if (todayAttendance.length === 0) {
                showNotification('Ê≤íÊúâÈªûÂêçË®òÈåÑÂèØÂêåÊ≠•', 'warning');
                return;
            }
            
            // üí° ‰∏äÂÇ≥ÂâçÁ¢∫Ë™ç
            const recordCount = todayAttendance.length;
            if (!confirm(`üì§ Ê∫ñÂÇôËá™Âãï‰∏äÂÇ≥ ${recordCount} Á≠ÜÈªûÂêçË®òÈåÑÂà∞ Google Sheets\n\n‚ö†Ô∏è ‰∏äÂÇ≥ÊàêÂäüÂæåÂ∞áÊ∏ÖÁ©∫Êú¨Âú∞Ë®òÈåÑÔºåÈÅøÂÖçÈáçË§á‰∏äÂÇ≥\n\nÁ¢∫ÂÆöË¶ÅÁπºÁ∫åÂóéÔºü`)) {
                showNotification('Â∑≤ÂèñÊ∂à‰∏äÂÇ≥', 'warning');
                return;
            }
            
            try {
                showNotification('Ê≠£Âú®Ëá™Âãï‰∏äÂÇ≥ÈªûÂêçË®òÈåÑÂà∞ Google Sheets...', 'warning');
                
                // Ê∫ñÂÇô‰∏äÂÇ≥Ë≥áÊñô - ÊåâÁÖßÊ≠£Á¢∫Ê†ºÂºèÔºöÊó•Êúü„ÄÅÁè≠Âà•„ÄÅÂ≠∏Âì°ID„ÄÅÂ≠∏Âì°ÂßìÂêç„ÄÅÂá∫Â∏≠ÁãÄÊÖã
                const attendanceForSync = todayAttendance.map(record => ({
                    date: record.date,
                    class: record.className,
                    studentId: record.studentId,
                    studentName: record.studentName,
                    status: record.status
                }));
                
                console.log('Ê∫ñÂÇôËá™Âãï‰∏äÂÇ≥ÁöÑÈªûÂêçË®òÈåÑ:', attendanceForSync);
                
                // Ê™¢Êü•ÊòØÂê¶ÁÇ∫ Vercel ÈÉ®ÁΩ≤ÁâàÊú¨
                const isVercel = window.location.hostname.includes('vercel.app');
                const apiUrl = isVercel ? '/api/sync-attendance' : window.location.origin + '/api/sync-attendance';
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Cache-Control': 'no-cache'
                    },
                    body: JSON.stringify({
                        attendance: attendanceForSync
                    })
                });
                
                console.log('API ÈüøÊáâÁãÄÊÖã:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('API ÈüøÊáâÁµêÊûú:', result);
                
                if (result.success) {
                    showNotification(`‚úÖ Â∑≤ÊàêÂäüËá™Âãï‰∏äÂÇ≥ ${recordCount} Á≠ÜÈªûÂêçË®òÈåÑÂà∞ Google Sheets`, 'success');
                    console.log('‚úÖ ÈªûÂêçË®òÈåÑËá™Âãï‰∏äÂÇ≥ÊàêÂäü');
                    
                    // üîß ÊàêÂäü‰∏äÂÇ≥ÂæåÊ∏ÖÁ©∫Êú¨Âú∞Ë®òÈåÑ
                    todayAttendance = [];
                    localStorage.setItem('todayAttendance', JSON.stringify(todayAttendance));
                    
                    // Êõ¥Êñ∞È°ØÁ§∫
                    displayTodayAttendance();
                    updateAttendanceCount();
                    
                    console.log(`‚úÖ Â∑≤Ê∏ÖÁ©∫Êú¨Âú∞ÈªûÂêçË®òÈåÑÔºåÈÅøÂÖçÈáçË§á‰∏äÂÇ≥`);
                    showNotification(`üéâ ‰∏äÂÇ≥ÂÆåÊàêÔºÅÊú¨Âú∞Ë®òÈåÑÂ∑≤Ê∏ÖÁ©∫ÔºåÂèØ‰ª•ÈÄ≤Ë°å‰∏ã‰∏ÄËº™ÈªûÂêç`, 'success');
                    
                } else {
                    throw new Error(result.error || 'Ëá™Âãï‰∏äÂÇ≥Â§±Êïó');
                }
                
            } catch (error) {
                console.error('‚ùå Ëá™Âãï‰∏äÂÇ≥ÈªûÂêçË®òÈåÑÂ§±Êïó:', error);
                
                // Â¶ÇÊûúËá™Âãï‰∏äÂÇ≥Â§±ÊïóÔºåÊèê‰æõÂÇôÁî®ÁöÑÊâãÂãïÊñπÂºè
                if (error.message.includes('Unexpected token') || error.message.includes('not valid JSON') || error.message.includes('404')) {
                    showNotification('‚ö†Ô∏è Ëá™Âãï‰∏äÂÇ≥Â§±ÊïóÔºåÁÇ∫ÊÇ®Ê∫ñÂÇôÊâãÂãï‰∏äÂÇ≥Ë≥áÊñô...', 'warning');
                    
                    // ÂÇôÁî®ÔºöÊ∫ñÂÇôÊâãÂãïË§áË£ΩÁöÑË≥áÊñô
                    const recordsForCopy = todayAttendance.map(record => 
                        `${record.date}\t${record.className}\t${record.studentId}\t${record.studentName}\t${record.status}`
                    ).join('\n');
                    
                    const header = 'Êó•Êúü\tÁè≠Âà•\tÂ≠∏Âì°ID\tÂ≠∏Âì°ÂßìÂêç\tÂá∫Â∏≠ÁãÄÊÖã\n';
                    const fullData = header + recordsForCopy;
                    
                    try {
                        await navigator.clipboard.writeText(fullData);
                        showNotification('üìã Â∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÊùøÔºåË´ãÊâãÂãïË≤ºÂà∞ Google Sheets', 'warning');
                        
                        // Ë©¢ÂïèÁî®Êà∂ÊòØÂê¶Ë¶ÅÊ∏ÖÁ©∫Êú¨Âú∞Ë®òÈåÑ
                        if (confirm(`Ëá™Âãï‰∏äÂÇ≥Â§±ÊïóÔºå‰ΩÜË≥áÊñôÂ∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÊùøÔºÅ\n\nË´ãÂà∞ Google Sheets ÊâãÂãïË≤º‰∏äË≥áÊñô„ÄÇ\n\nÊòØÂê¶Ë¶ÅÊ∏ÖÁ©∫Êú¨Âú∞Ë®òÈåÑÔºü\nÔºàÂª∫Ë≠∞Âú®Á¢∫Ë™çË≤º‰∏äÊàêÂäüÂæåÂÜçÊ∏ÖÁ©∫Ôºâ`)) {
                            todayAttendance = [];
                            localStorage.setItem('todayAttendance', JSON.stringify(todayAttendance));
                            displayTodayAttendance();
                            updateAttendanceCount();
                            console.log(`‚úÖ Áî®Êà∂ÈÅ∏ÊìáÊ∏ÖÁ©∫Êú¨Âú∞Ë®òÈåÑ`);
                            showNotification('‚úÖ Êú¨Âú∞Ë®òÈåÑÂ∑≤Ê∏ÖÁ©∫', 'success');
                        }
                        
                        alert(`Ëá™Âãï‰∏äÂÇ≥Â§±ÊïóÔºå‰ΩÜË≥áÊñôÂ∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÊùøÔºÅ\n\nË´ãÂà∞ÊÇ®ÁöÑ Google Sheets ÊâãÂãïË≤º‰∏äÔºö\n1. ÈñãÂïüÊÇ®ÁöÑ Google Sheets\n2. ÈÅ∏Êìá„Äåattendance„ÄçÂ∑•‰ΩúË°®\n3. Êåâ Ctrl+V Ë≤º‰∏äË≥áÊñô`);
                    } catch (clipboardError) {
                        showNotification('‚ùå Ëá™Âãï‰∏äÂÇ≥ÂíåË§áË£ΩÈÉΩÂ§±ÊïóÔºåË´ãÊ™¢Êü•Á∂≤Ë∑ØÈÄ£Êé•', 'error');
                    }
                } else {
                    showNotification('‚ùå Ëá™Âãï‰∏äÂÇ≥Â§±Êïó: ' + error.message, 'error');
                }
            }
        }
        
        // È°ØÁ§∫‰ªäÊó•Âá∫Â∏≠Ë®òÈåÑ
        function displayTodayAttendance() {
            const list = document.getElementById('todayAttendanceList');
            const today = new Date().toISOString().split('T')[0];
            const todayRecords = todayAttendance.filter(att => att.date === today);
            
            if (todayRecords.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <h3>üìù ÈÇÑÊ≤íÊúâ‰ªäÊó•ÁöÑÈªûÂêçË®òÈåÑ</h3>
                        <p>ÈÅ∏ÊìáÁè≠Âà•‰∏¶ÈñãÂßãÈªûÂêç</p>
                    </div>
                `;
                return;
            }
            
            // ÊåâÁè≠Âà•ÂàÜÁµÑ
            const groupedByClass = {};
            todayRecords.forEach(att => {
                if (!groupedByClass[att.className]) {
                    groupedByClass[att.className] = [];
                }
                groupedByClass[att.className].push(att);
            });
            
            let html = '';
            Object.keys(groupedByClass).forEach(className => {
                const classRecords = groupedByClass[className];
                html += `
                    <div style="margin-bottom: 30px;">
                        <h4 style="color: #333; margin-bottom: 15px; font-size: 18px;">üìö ${className}</h4>
                        ${classRecords.map(att => `
                            <div class="student-item" style="margin-bottom: 10px;">
                                <div>
                                    <div style="font-size: 16px; font-weight: 600; color: #333;">
                                        ${att.studentName}
                                        <span style="color: ${getAttendanceColor(att.status)}; font-weight: 600; margin-left: 10px;">
                                            ${getAttendanceIcon(att.status)} ${att.status}
                                        </span>
                                    </div>
                                    <div style="color: #999; font-size: 13px;">
                                        üìù ${att.createdAt}
                                    </div>
                                </div>
                                <div>
                                    <button class="btn btn-danger" onclick="deleteAttendance('${att.id}')" 
                                            title="Âà™Èô§Ë®òÈåÑ" style="padding: 8px 12px; font-size: 12px;">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            });
            
            list.innerHTML = html;
        }

        // Áç≤ÂèñÂá∫Â∏≠ÁãÄÊÖãÈ°èËâ≤
        function getAttendanceColor(status) {
            switch (status) {
                case 'Âá∫Â∏≠': return '#28a745';
                case 'Áº∫Â∏≠': return '#dc3545';
                case 'Ë´ãÂÅá': return '#6c757d';
                case 'ÈÅ≤Âà∞': return '#ffc107';
                default: return '#007bff';
            }
        }

        // Áç≤ÂèñÂá∫Â∏≠ÁãÄÊÖãÂúñÊ®ô
        function getAttendanceIcon(status) {
            switch (status) {
                case 'Âá∫Â∏≠': return '‚úÖ';
                case 'Áº∫Â∏≠': return '‚ùå';
                case 'Ë´ãÂÅá': return 'üè•';
                case 'ÈÅ≤Âà∞': return '‚è∞';
                default: return 'üìù';
            }
        }

        // Âà™Èô§Âá∫Â∏≠Ë®òÈåÑ
        function deleteAttendance(id) {
            const att = todayAttendance.find(a => a.id === id);
            if (!att) return;
            
            if (confirm(`Á¢∫ÂÆöË¶ÅÂà™Èô§„Äå${att.studentName}„ÄçÁöÑÈªûÂêçË®òÈåÑÂóéÔºü`)) {
                todayAttendance = todayAttendance.filter(a => a.id !== id);
                localStorage.setItem('todayAttendance', JSON.stringify(todayAttendance));
                displayTodayAttendance();
                showNotification('üóëÔ∏è Â∑≤Âà™Èô§ÈªûÂêçË®òÈåÑ', 'warning');
            }
        }

        // ÂåØÂá∫Â≠∏Âì°Ê∏ÖÂñÆ
        function exportStudentList() {
            if (students.length === 0) {
                showNotification('Ê≤íÊúâÂ≠∏Âì°Ë≥áÊñôÂèØÂåØÂá∫', 'warning');
                return;
            }

            const csvContent = "data:text/csv;charset=utf-8," 
                + "Â≠∏Âì°ID,Â≠∏Âì°ÂßìÂêç,Âà•Âêç,Áè≠Âà•,ÈõªË©±,‰ø°ÁÆ±,ÁîüÊó•,Á∑äÊÄ•ËÅØÁµ°‰∫∫,Á∑äÊÄ•ËÅØÁµ°ÈõªË©±,ÁãÄÊÖã,Âª∫Á´ãÊó•Êúü,ÂÇôË®ª\n"
                + students.map(student => 
                    `"${student.id || ''}","${student.name}","${student.nickname || ''}","${student.class || ''}","${student.phone || ''}","${student.email || ''}","${student.birthday ? formatBirthday(student.birthday) : ''}","${student.emergencyContact || ''}","${student.emergencyPhone || ''}","${student.status}","${student.createdAt}","${student.remarks || ''}"`
                ).join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `Â≠∏Âì°Ê∏ÖÂñÆ_${new Date().toLocaleDateString('zh-TW').replace(/\//g, '-')}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification(`üìÑ Â≠∏Âì°Ê∏ÖÂñÆÂ∑≤ÂåØÂá∫ (${students.length} Á≠ÜË≥áÊñô)`, 'success');
        }

        // È†ÅÈù¢ËºâÂÖ•ÊôÇÂü∑Ë°å (Á∞°ÂåñÁâàÔºåÁßªÈô§ÁÑ°Áî®‰ª£Á¢º)
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Â≠∏Âì°ÁÆ°ÁêÜÁ≥ªÁµ±ÂïüÂãï - Èõ≤Á´ØÂêåÊ≠•Ê®°Âºè');
            fetchClassList();
            loadStudentsFromCloud();
        });

        // Ê†ºÂºèÂåñÁîüÊó•Êó•ÊúüÈ°ØÁ§∫
        function formatBirthday(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const day = date.getDate();
            const month = months[date.getMonth()];
            return `${day}-${month}`;
        }

        // ËôïÁêÜÁîüÊó•Ëº∏ÂÖ•ÔºåËá™ÂãïËΩâÊèõÊ†ºÂºè
        function handleBirthdayInput() {
            const birthdayInput = document.getElementById('studentBirthday');
            if (birthdayInput.value) {
                const formatted = formatBirthday(birthdayInput.value);
                console.log(`üéÇ ÁîüÊó•Ê†ºÂºèÂåñ: ${birthdayInput.value} ‚Üí ${formatted}`);
            }
        }

        // ÂæûscheduleÈ†ÅÈù¢Áç≤ÂèñÁè≠Âà•ÂàóË°®
        async function fetchClassList() {
            try {
                // ‰ΩøÁî®Vercel API route‰æÜÁç≤ÂèñÁè≠Âà•
                const response = await fetch('/api/get-classes', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const result = await response.json();
                if (result.success && result.classes) {
                    updateClassSelect(result.classes);
                    console.log('‚úÖ ÊàêÂäüËºâÂÖ•Áè≠Âà•ÂàóË°®:', result.classes);
                } else {
                    throw new Error('ÁÑ°Ê≥ïÁç≤ÂèñÁè≠Âà•ÂàóË°®');
                }
            } catch (error) {
                console.error('Áç≤ÂèñÁè≠Âà•ÂàóË°®Â§±Êïó:', error);
                showNotification('‚ùå ÁÑ°Ê≥ïËºâÂÖ•Áè≠Âà•ÂàóË°®Ôºå‰ΩøÁî®È†êË®≠ÈÅ∏È†Ö', 'warning');
                
                // Â¶ÇÊûúAPIÂ§±ÊïóÔºåÊèê‰æõÊâãÂãïËº∏ÂÖ•ÈÅ∏È†Ö
                const select = document.getElementById('studentClass');
                select.innerHTML = `
                    <option value="">Ë´ãÈÅ∏ÊìáÁè≠Âà•</option>
                    <option value="ÈùíÂπ¥Áè≠">ÈùíÂπ¥Áè≠</option>
                    <option value="Êàê‰∫∫Áè≠">Êàê‰∫∫Áè≠</option>
                    <option value="ÂÖíÁ´•Áè≠">ÂÖíÁ´•Áè≠</option>
                `;
            }
        }

        // Êõ¥Êñ∞Áè≠Âà•‰∏ãÊãâÈÅ∏ÂñÆ
        function updateClassSelect(classes) {
            const select = document.getElementById('studentClass');
            // ‰øùÁïôÁ¨¨‰∏ÄÂÄã"Ë´ãÈÅ∏ÊìáÁè≠Âà•"ÈÅ∏È†Ö
            select.innerHTML = '<option value="">Ë´ãÈÅ∏ÊìáÁè≠Âà•</option>';
            
            // ËôïÁêÜ‰∏çÂêåÁöÑË≥áÊñôÊ†ºÂºè
            if (Array.isArray(classes)) {
                classes.forEach(classItem => {
                    const option = document.createElement('option');
                    
                    // ÊîØÊè¥‰∏çÂêåÁöÑË≥áÊñôÊ†ºÂºè
                    if (typeof classItem === 'string') {
                        // Á∞°ÂñÆÂ≠ó‰∏≤Ê†ºÂºè
                        option.value = classItem;
                        option.textContent = classItem;
                    } else if (classItem.class_id) {
                        // Áâ©‰ª∂Ê†ºÂºè {class_id: "ÈùíÂπ¥Áè≠", class_name: "ÈùíÂπ¥Áè≠ÊèèËø∞"}
                        option.value = classItem.class_id;
                        option.textContent = classItem.class_name ? 
                            `${classItem.class_id} (${classItem.class_name})` : 
                            classItem.class_id;
                    } else if (classItem.name) {
                        // Áâ©‰ª∂Ê†ºÂºè {name: "ÈùíÂπ¥Áè≠"}
                        option.value = classItem.name;
                        option.textContent = classItem.name;
                    }
                    
                    select.appendChild(option);
                });
                
                console.log(`‚úÖ Â∑≤ËºâÂÖ• ${classes.length} ÂÄãÁè≠Âà•ÈÅ∏È†Ö`);
            } else {
                console.warn('‚ö†Ô∏è Áè≠Âà•Ë≥áÊñôÊ†ºÂºè‰∏çÊ≠£Á¢∫:', classes);
            }
        }

        // È†ÅÈù¢ËºâÂÖ•ÊôÇÂàùÂßãÂåñ
        window.addEventListener('load', () => {
            console.log('üöÄ Â≠∏Âì°ÁÆ°ÁêÜÁ≥ªÁµ±ÂïüÂãï - Èõ≤Á´ØÂêåÊ≠•Ê®°Âºè');
            fetchClassList();
            loadStudentsFromCloud();
        });

        // ÂæûÈõ≤Á´ØËºâÂÖ•Â≠∏Âì°ÂàóË°®
        async function loadStudentsFromCloud() {
            showNotification('üîÑ Ê≠£Âú®ËºâÂÖ•Â≠∏Âì°ÂàóË°®...', 'info');
            
            try {
                const response = await fetch('/api/get-students', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const result = await response.json();
                
                if (result.success && result.students) {
                    displayStudents(result.students);
                    updateStatistics(result.students);
                    console.log('‚úÖ ÊàêÂäüËºâÂÖ•Â≠∏Âì°ÂàóË°®:', result.students.length, 'Á≠ÜË≥áÊñô');
                    showNotification(`‚úÖ Â∑≤ËºâÂÖ• ${result.students.length} Á≠ÜÂ≠∏Âì°Ë≥áÊñô`, 'success');
                } else {
                    throw new Error('ÁÑ°Ê≥ïËºâÂÖ•Â≠∏Âì°ÂàóË°®');
                }
            } catch (error) {
                console.error('ËºâÂÖ•Â≠∏Âì°ÂàóË°®Â§±Êïó:', error);
                showNotification('‚ùå ËºâÂÖ•Â≠∏Âì°ÂàóË°®Â§±ÊïóÔºö' + error.message, 'error');
                
                // È°ØÁ§∫Á©∫ÁãÄÊÖã
                const list = document.getElementById('studentList');
                list.innerHTML = `
                    <div class="empty-state">
                        <h3>‚ö†Ô∏è ÁÑ°Ê≥ïËºâÂÖ•Â≠∏Âì°Ë≥áÊñô</h3>
                        <p>Ë´ãÊ™¢Êü•Á∂≤Ë∑ØÈÄ£Á∑öÊàñËÅØÁπ´Á≥ªÁµ±ÁÆ°ÁêÜÂì°<br>
                        ÈåØË™§Ë©≥ÊÉÖÔºö${error.message}</p>
                        <button class="btn btn-primary" onclick="loadStudentsFromCloud()" style="margin-top: 15px;">
                            üîÑ ÈáçÊñ∞ËºâÂÖ•
                        </button>
                    </div>
                `;
            }
        }

        // È°ØÁ§∫Â≠∏Âì°ÂàóË°® (Êé•Êî∂Â≠∏Âì°Èô£Âàó‰ΩúÁÇ∫ÂèÉÊï∏)
        function displayStudents(studentArray = []) {
            const list = document.getElementById('studentList');
            
            if (studentArray.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <h3>üìö ÈÇÑÊ≤íÊúâÂ≠∏Âì°Ë≥áÊñô</h3>
                        <p>ÈªûÊìä‰∏äÊñπÁöÑ„ÄåÊñ∞Â¢ûÂ≠∏Âì°„ÄçÊåâÈàïÈñãÂßãÂª∫Á´ã‰Ω†ÁöÑÂ≠∏Âì°ÂêçÂÜä<br>
                        ÊâÄÊúâË≥áÊñôÊúÉÁõ¥Êé•ÂÑ≤Â≠òÂà∞ Google Sheets ‰∏≠</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = studentArray.map(student => `
                <div class="student-item">
                    <div>
                        <div style="font-size: 20px; font-weight: 700; margin-bottom: 8px; color: #333;">
                            ${student.name}
                            ${student.nickname ? `<span style="color: #666; font-weight: 400; font-size: 16px;">(${student.nickname})</span>` : ''}
                            <span style="color: #999; font-weight: 400; font-size: 14px; margin-left: 10px;">ID: ${student.id}</span>
                        </div>
                        <div style="color: #666; font-size: 15px; margin-bottom: 5px;">
                            <span style="margin-right: 20px; background: #e3f2fd; padding: 4px 12px; border-radius: 20px; color: #1976d2;">
                                üìö ${student.class || 'Êú™ÂàÜÈÖçÁè≠Âà•'}
                            </span>
                            <span style="color: ${getStatusColor(student.status)}; font-weight: 600;">
                                ‚óè ${student.status}
                            </span>
                        </div>
                        <div style="color: #999; font-size: 13px; line-height: 1.4;">
                            üìÖ ${student.createdAt} Âª∫Á´ã
                            ${student.phone ? ` | üìû ${student.phone}` : ''}
                            ${student.email ? ` | üìß ${student.email}` : ''}
                            ${student.birthday ? ` | üéÇ ${student.birthday}` : ''}
                        </div>
                        ${student.emergencyContact || student.emergencyPhone ? `
                            <div style="color: #e74c3c; font-size: 12px; margin-top: 4px;">
                                üö® Á∑äÊÄ•ËÅØÁµ°: ${student.emergencyContact || ''}${student.emergencyPhone ? ` (${student.emergencyPhone})` : ''}
                            </div>
                        ` : ''}
                    </div>
                    <div>
                        <button class="btn btn-danger" onclick="deleteStudentFromCloud('${student.id}')" 
                                title="Âà™Èô§Â≠∏Âì°" style="padding: 10px 15px;">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ÂæûÈõ≤Á´ØÂà™Èô§Â≠∏Âì°
        async function deleteStudentFromCloud(studentId) {
            if (!confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄô‰ΩçÂ≠∏Âì°ÂóéÔºüÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©Âéü„ÄÇ')) {
                return;
            }

            showNotification('üîÑ Ê≠£Âú®Âà™Èô§Â≠∏Âì°...', 'info');

            try {
                // Ê≥®ÊÑèÔºöÁõÆÂâçÂèØËÉΩÊ≤íÊúâÂ∞àÈñÄÁöÑÂà™Èô§APIÔºåÊâÄ‰ª•ÂÖàÊèêÁ§∫ÊâãÂãïÂà™Èô§
                showNotification('‚ö†Ô∏è Ë´ãÊâãÂãïÂà∞ Google Sheets Âà™Èô§Ê≠§Â≠∏Âì°Ë®òÈåÑ', 'warning', 5000);
                
                // Â¶ÇÊûúÊúâÂà™Èô§APIÔºåÂèØ‰ª•‰ΩøÁî®‰ª•‰∏ã‰ª£Á¢ºÔºö
                /*
                const response = await fetch('/api/delete-student', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        studentId: studentId
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('‚úÖ Â≠∏Âì°Â∑≤ÊàêÂäüÂà™Èô§', 'success');
                    await loadStudentsFromCloud();
                } else {
                    throw new Error(result.message || 'Âà™Èô§Â§±Êïó');
                }
                */
            } catch (error) {
                console.error('Âà™Èô§Â≠∏Âì°ÈåØË™§:', error);
                showNotification('‚ùå Âà™Èô§Â≠∏Âì°Â§±ÊïóÔºö' + error.message, 'error');
            }
        }

        // Êõ¥Êñ∞Áµ±Ë®àË≥áË®ä
        function updateStatistics(studentArray = []) {
            const totalStudents = studentArray.length;
            const activeStudents = studentArray.filter(s => s.status === 'Âú®ËÆÄ').length;
            const classes = [...new Set(studentArray.map(s => s.class))].filter(c => c).length;
            
            console.log(`üìä Áµ±Ë®à: Á∏ΩÂ≠∏Âì° ${totalStudents}, Âú®ËÆÄ ${activeStudents}, Áè≠Âà• ${classes}`);
        }

        // ÂÑ≤Â≠ò‰∏¶Ëá™Âãï‰∏äÂÇ≥ÈªûÂêçË®òÈåÑ (‰∏ÄÈçµÂÆåÊàê)
        async function saveAndUploadAttendance() {
            console.log('=== ÈñãÂßãÂÑ≤Â≠ò‰∏¶Ëá™Âãï‰∏äÂÇ≥ÈªûÂêçË®òÈåÑ ===');
            
            // ÂÖàÂÑ≤Â≠òÂà∞Êú¨Âú∞
            await saveAttendance();
            
            // Á≠âÂæÖ‰∏Ä‰∏ãËÆìÊú¨Âú∞ÂÑ≤Â≠òÂÆåÊàê
            setTimeout(async () => {
                // Ê™¢Êü•ÊòØÂê¶ÊúâË®òÈåÑ
                if (todayAttendance.length > 0) {
                    console.log('‚úÖ Êú¨Âú∞ÂÑ≤Â≠òÂÆåÊàêÔºåÈñãÂßãËá™Âãï‰∏äÂÇ≥...');
                    // Ëá™Âãï‰∏äÂÇ≥Âà∞ Google Sheets
                    await syncAttendanceToCloud();
                } else {
                    console.log('‚ö†Ô∏è Ê≤íÊúâÈªûÂêçË®òÈåÑÂèØ‰∏äÂÇ≥');
                }
            }, 1000);
        }
    </script>
</body>
</html>
