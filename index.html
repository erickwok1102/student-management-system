<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Â≠∏Âì°ÁÆ°ÁêÜÁ≥ªÁµ± - ‰øÆÂæ©Áâà v2.2</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); 
            color: #333; 
            min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; padding: 40px; border-radius: 20px; margin-bottom: 30px; 
            text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .header p { font-size: 1.2rem; opacity: 0.9; }
        .card { 
            background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
            border-radius: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); 
            padding: 30px; margin-bottom: 25px; border: 1px solid rgba(255,255,255,0.2);
        }
        .btn { 
            padding: 14px 28px; border: none; border-radius: 12px; cursor: pointer; 
            font-size: 16px; margin: 8px; transition: all 0.3s ease; font-weight: 600;
        }
        .btn-primary { background: linear-gradient(135deg, #007bff, #0056b3); color: white; }
        .btn-success { background: linear-gradient(135deg, #28a745, #1e7e34); color: white; }
        .btn-warning { background: linear-gradient(135deg, #ffc107, #e0a800); color: #212529; }
        .btn-danger { background: linear-gradient(135deg, #dc3545, #c82333); color: white; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        
        .form-group { margin-bottom: 25px; }
        .form-group label { 
            display: block; margin-bottom: 8px; font-weight: 600; 
            color: #555; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .form-group input, .form-group select, .form-group textarea { 
            width: 100%; padding: 15px 20px; border: 2px solid #e1e5e9; 
            border-radius: 12px; font-size: 16px; transition: all 0.3s ease;
            background: rgba(255,255,255,0.8);
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none; border-color: #007bff; 
            box-shadow: 0 0 0 4px rgba(0,123,255,0.1);
            background: white;
        }
        
        .student-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 25px; border-radius: 15px; margin-bottom: 15px; 
            background: linear-gradient(135deg, #f8f9fa, #e9ecef); 
            transition: all 0.3s ease; border-left: 5px solid #007bff;
        }
        .student-item:hover { 
            background: linear-gradient(135deg, #e9ecef, #dee2e6); 
            transform: translateX(10px); box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .notification { 
            position: fixed; top: 30px; right: 30px; padding: 20px 30px; 
            border-radius: 15px; color: white; font-weight: 600; z-index: 1000; 
            opacity: 0; transition: all 0.4s ease; box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .notification.success { background: linear-gradient(135deg, #28a745, #20c997); }
        .notification.error { background: linear-gradient(135deg, #dc3545, #e74c3c); }
        .notification.warning { background: linear-gradient(135deg, #ffc107, #f39c12); color: #333; }
        .notification.show { opacity: 1; transform: translateY(0); }
        
        .status-indicator { 
            display: inline-block; width: 14px; height: 14px; border-radius: 50%; 
            margin-left: 10px; animation: pulse 2s infinite;
        }
        .status-online { background: #28a745; box-shadow: 0 0 15px rgba(40,167,69,0.6); }
        .status-offline { background: #dc3545; box-shadow: 0 0 15px rgba(220,53,69,0.6); }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .tabs { 
            display: flex; border-bottom: 3px solid #e9ecef; margin-bottom: 30px; 
            background: rgba(255,255,255,0.9); border-radius: 15px 15px 0 0; 
            overflow: hidden; backdrop-filter: blur(10px);
        }
        .tab { 
            padding: 20px 35px; cursor: pointer; border: none; background: none; 
            font-size: 16px; font-weight: 600; transition: all 0.3s ease; 
            position: relative; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .tab.active { 
            background: linear-gradient(135deg, #007bff, #0056b3); 
            color: white; 
        }
        .tab:not(.active):hover { background: rgba(0,123,255,0.1); }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s ease; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .grid-form { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 25px; 
        }
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 25px; 
        }
        .stat-card { 
            background: linear-gradient(135deg, #f8f9fa, #e9ecef); 
            padding: 30px; border-radius: 20px; text-align: center; 
            border-left: 6px solid #007bff; transition: all 0.3s ease;
        }
        .stat-card:hover { 
            transform: translateY(-8px); 
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }
        
        .sync-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 30px; 
        }
        .sync-card { 
            text-align: center; padding: 40px; border-radius: 20px; 
            background: linear-gradient(135deg, #f8f9fa, #e9ecef); 
            transition: all 0.3s ease;
        }
        .sync-card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
        }
        
        .empty-state { 
            text-align: center; padding: 80px 20px; color: #999; 
        }
        .empty-state h3 { 
            margin-bottom: 15px; color: #666; font-size: 24px; 
        }
        .empty-state p { font-size: 16px; line-height: 1.6; }
        
        /* ÈªûÂêçÊåâÈàïÊ®£Âºè */
        .attendance-btn {
            transition: all 0.3s ease !important;
            border: 2px solid transparent !important;
            font-weight: 600 !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            cursor: pointer !important;
        }
        
        .attendance-btn:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2) !important;
        }
        
        .attendance-btn:active {
            transform: translateY(0) !important;
        }
        
        .attendance-btn.selected {
            border: 3px solid #fff !important;
            box-shadow: 0 0 0 4px rgba(13, 110, 253, 0.25), 0 4px 12px rgba(0,0,0,0.3) !important;
            transform: scale(0.95) !important;
        }
        
        .attendance-btn .check-mark {
            animation: checkMarkAppear 0.3s ease !important;
        }
        
        @keyframes checkMarkAppear {
            0% { 
                transform: scale(0) rotate(180deg); 
                opacity: 0; 
            }
            50% { 
                transform: scale(1.2) rotate(0deg); 
                opacity: 1; 
            }
            100% { 
                transform: scale(1) rotate(0deg); 
                opacity: 1; 
            }
        }
        
        .btn-success.selected {
            background-color: #198754 !important;
            border-color: #146c43 !important;
        }
        
        .btn-warning.selected {
            background-color: #fd7e14 !important;
            border-color: #fd7e14 !important;
        }
        
        .btn-primary.selected {
            background-color: #0d6efd !important;
            border-color: #0a58ca !important;
        }

        /* ÈüøÊáâÂºèË®≠Ë®à */
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .header { padding: 30px 20px; }
            .header h1 { font-size: 2rem; }
            .grid-form { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); gap: 15px; }
            .sync-grid { grid-template-columns: 1fr; }
            .tabs { flex-wrap: wrap; }
            .tab { padding: 15px 20px; }
            .attendance-btn { padding: 8px 16px !important; font-size: 14px !important; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì Â≠∏Âì°ÁÆ°ÁêÜÁ≥ªÁµ±</h1>
            <p>‰øÆÂæ©Áâà - Á∞°ÂåñÁè≠Âà•ÁÆ°ÁêÜ</p>
            <div style="margin-top: 20px;">
                <span style="font-size: 16px;">Á≥ªÁµ±ÁãÄÊÖã:</span>
                <span class="status-indicator status-online" id="serverStatus"></span>
                <span id="statusText" style="font-weight: 600;">Ê≠£Â∏∏ÈÅãË°å</span>
            </div>
        </div>

        <!-- Ê®ôÁ±§È†ÅÂ∞éËà™ -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('students', this)">üë• Êñ∞Â¢ûÂ≠∏Âì°</button>
            <button class="tab" onclick="showTab('attendance', this)">‚úÖ ÈªûÂêçÁ≥ªÁµ±</button>
            <button class="tab" onclick="showTab('sync', this)">‚òÅÔ∏è Èõ≤Á´ØÂêåÊ≠•</button>
        </div>

        <!-- Â≠∏Âì°ÁÆ°ÁêÜÊ®ôÁ±§ -->
        <div id="studentsTab" class="tab-content active">
            <div class="card">
                <h3 style="margin-bottom: 30px; color: #333; font-size: 24px;">‚ûï Êñ∞Â¢ûÂ≠∏Âì°</h3>
                <div class="grid-form">
                    <div class="form-group">
                        <label>Â≠∏Âì°ÂßìÂêç *</label>
                        <input type="text" id="studentName" placeholder="Ë´ãËº∏ÂÖ•Â≠∏Âì°ÂßìÂêç" required>
                    </div>
                    <div class="form-group">
                        <label>Âà•Âêç/Ëã±ÊñáÂêç</label>
                        <input type="text" id="studentNickname" placeholder="Âà•ÂêçÊàñËã±ÊñáÂêç (ÈÅ∏Â°´)">
                    </div>
                    <div class="form-group">
                        <label>Áè≠Âà• *</label>
                        <input type="text" id="studentClass" placeholder="Ë´ãËº∏ÂÖ•Áè≠Âà•ÂêçÁ®±" list="classDatalist" required>
                        <datalist id="classDatalist">
                            <!-- Áè≠Âà•ÈÅ∏È†ÖÊúÉÂãïÊÖãËºâÂÖ• -->
                        </datalist>
                    </div>
                    <div class="form-group">
                        <label>ËÅØÁµ°ÈõªË©±</label>
                        <input type="tel" id="studentPhone" placeholder="ËÅØÁµ°ÈõªË©±">
                    </div>
                    <div class="form-group">
                        <label>ÈõªÂ≠ê‰ø°ÁÆ±</label>
                        <input type="email" id="studentEmail" placeholder="ÈõªÂ≠ê‰ø°ÁÆ±">
                    </div>
                    <div class="form-group">
                        <label>ÁãÄÊÖã</label>
                        <select id="studentStatus">
                            <option value="Âú®ËÆÄ">Âú®ËÆÄ</option>
                            <option value="‰ºëÂ≠∏">‰ºëÂ≠∏</option>
                            <option value="Áï¢Ê•≠">Áï¢Ê•≠</option>
                            <option value="ÈÄÄÂ≠∏">ÈÄÄÂ≠∏</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>ÂÇôË®ª</label>
                    <textarea id="studentRemarks" placeholder="ÂÖ∂‰ªñÂÇôË®ªË≥áË®ä" rows="4"></textarea>
                </div>
                <div style="margin-top: 30px; text-align: center;">
                    <button class="btn btn-success" onclick="addStudent()">‚ûï Êñ∞Â¢ûÂ≠∏Âì°</button>
                    <button class="btn btn-primary" onclick="loadStudents()">üîÑ ÈáçÊñ∞ËºâÂÖ•</button>
                    <button class="btn btn-warning" onclick="clearForm()">üßπ Ê∏ÖÁ©∫Ë°®ÂñÆ</button>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 25px; color: #333; font-size: 24px;">üìã Â≠∏Âì°ÂàóË°®</h3>
                <div class="student-list" id="studentList">
                    <div class="empty-state">
                        <h3>üîÑ ËºâÂÖ•‰∏≠...</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÈªûÂêçÁ≥ªÁµ±Ê®ôÁ±§ -->
        <div id="attendanceTab" class="tab-content">
            <div class="card">
                <h3 style="margin-bottom: 25px; color: #333; font-size: 24px;">‚úÖ ÈªûÂêçÁ≥ªÁµ±</h3>
                
                <div class="grid-form">
                    <div class="form-group">
                        <label>Êó•Êúü *</label>
                        <input type="date" id="attendanceDate" required>
                    </div>
                    <div class="form-group">
                        <label>Áè≠Âà• *</label>
                        <select id="attendanceClass" required onchange="loadStudentsForAttendance()">
                            <option value="">Ë´ãÈÅ∏ÊìáÁè≠Âà•</option>
                            <!-- Áè≠Âà•ÈÅ∏È†ÖÂ∞áÂæûÂ≠∏Âì°Ë≥áÊñô‰∏≠ÂãïÊÖãËºâÂÖ• -->
                        </select>
                    </div>
                </div>

                <div style="margin-top: 30px; text-align: center;">
                    <button class="btn btn-primary" onclick="startAttendance()">üöÄ ÈñãÂßãÈªûÂêç</button>
                </div>
            </div>

            <!-- ÈªûÂêçÂàóË°® -->
            <div class="card" id="attendanceListCard" style="display: none;">
                <h3 style="margin-bottom: 25px; color: #333; font-size: 24px;">üìã ÈªûÂêçÂàóË°®</h3>
                <div id="attendanceStudentsList"></div>
                <div style="margin-top: 30px; text-align: center;">
                    <button class="btn btn-success" onclick="saveAttendance()">üíæ ÂÑ≤Â≠òÈªûÂêçË®òÈåÑ</button>
                    <button class="btn btn-warning" onclick="resetAttendance()">üîÑ ÈáçÊñ∞ÈªûÂêç</button>
                </div>
            </div>

            <!-- ‰ªäÊó•ÈªûÂêçË®òÈåÑ -->
            <div class="card">
                <h3 style="margin-bottom: 25px; color: #333; font-size: 24px;">üìÖ ‰ªäÊó•ÈªûÂêçË®òÈåÑ</h3>
                <div class="student-list" id="todayAttendanceList">
                    <div class="empty-state">
                        <h3>üìù ÈÇÑÊ≤íÊúâ‰ªäÊó•ÁöÑÈªûÂêçË®òÈåÑ</h3>
                        <p>ÈÅ∏ÊìáÁè≠Âà•‰∏¶ÈñãÂßãÈªûÂêç</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Èõ≤Á´ØÂêåÊ≠•Ê®ôÁ±§ -->
        <div id="syncTab" class="tab-content">
            <div class="card">
                <h3 style="margin-bottom: 30px; color: #333; font-size: 24px;">‚òÅÔ∏è Google Sheets ÂêåÊ≠•</h3>
                <div class="sync-grid">
                    <div class="sync-card">
                        <h4 style="color: #28a745; margin-bottom: 20px; font-size: 20px;">üì§ ‰∏äÂÇ≥Â≠∏Âì°Ë≥áÊñô</h4>
                        <button class="btn btn-success" onclick="syncToCloud()" style="width: 100%; margin-bottom: 20px;">
                            ‚òÅÔ∏è ÂêåÊ≠•Â≠∏Âì°Âà∞Èõ≤Á´Ø
                        </button>
                        <p style="font-size: 14px; color: #666; line-height: 1.6;">
                            Â∞áÊú¨Âú∞Â≠∏Âì°Ë≥áÊñô‰∏äÂÇ≥Âà∞ Google Sheets<br>
                            <strong>Ê≥®ÊÑèÔºö</strong>ÊúÉË¶ÜËìãÈõ≤Á´ØÁèæÊúâË≥áÊñô
                        </p>
                    </div>
                    <div class="sync-card">
                        <h4 style="color: #007bff; margin-bottom: 20px; font-size: 20px;">üì• ËºâÂÖ•Â≠∏Âì°Ë≥áÊñô</h4>
                        <button class="btn btn-primary" onclick="loadFromCloud()" style="width: 100%; margin-bottom: 20px;">
                            üì• ÂæûÈõ≤Á´ØËºâÂÖ•Â≠∏Âì°
                        </button>
                        <p style="font-size: 14px; color: #666; line-height: 1.6;">
                            Âæû Google Sheets ËºâÂÖ•Â≠∏Âì°Ë≥áÊñô<br>
                            <strong>Ê≥®ÊÑèÔºö</strong>ÊúÉË¶ÜËìãÊú¨Âú∞ÁèæÊúâË≥áÊñô
                        </p>
                    </div>
                    <div class="sync-card">
                        <h4 style="color: #ffc107; margin-bottom: 20px; font-size: 20px;">üìã ÈªûÂêçË®òÈåÑ</h4>
                        <button class="btn btn-warning" onclick="syncAttendanceToCloud()" style="width: 100%; margin-bottom: 10px;">
                            üì§ ‰∏äÂÇ≥ÈªûÂêçË®òÈåÑ
                        </button>
                        <button class="btn btn-primary" onclick="showAttendanceRecords()" style="width: 100%; margin-bottom: 20px;">
                            üëÄ Êü•ÁúãÊú¨Âú∞Ë®òÈåÑ
                        </button>
                        <p style="font-size: 14px; color: #666; line-height: 1.6;">
                            ÁÆ°ÁêÜÈªûÂêçË®òÈåÑÔºåÂèØÊü•ÁúãÊàñ‰∏äÂÇ≥Âà∞Èõ≤Á´Ø<br>
                            <strong>Ë®òÈåÑÊï∏Ôºö</strong><span id="attendanceCount">0</span> Á≠Ü
                        </p>
                    </div>
                </div>

                <div style="margin-top: 40px; padding: 25px; background: rgba(248,249,250,0.8); border-radius: 15px;">
                    <h4 style="color: #333; margin-bottom: 15px; font-size: 18px;">üìã ÂêåÊ≠•ÁãÄÊÖã</h4>
                    <p id="syncStatus" style="color: #666; font-size: 16px;">Á≥ªÁµ±Â∑≤ÂïüÂãïÔºåÊ∫ñÂÇôÂ∞±Á∑í</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ÈÄöÁü•ÂÖÉÁ¥† -->
    <div id="notification" class="notification"></div>

    <script>
        // ÂÖ®ÂüüËÆäÊï∏
        let students = [];
        let todayAttendance = [];
        let currentAttendanceClass = '';
        let currentAttendanceDate = '';

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Â≠∏Âì°ÁÆ°ÁêÜÁ≥ªÁµ±ÂïüÂãï‰∏≠...');
            showNotification('Ê≠°Ëøé‰ΩøÁî®Â≠∏Âì°ÁÆ°ÁêÜÁ≥ªÁµ±ÔºÅ', 'success');
            
            await loadStudents();
            updateClassOptions(); // ÂæûÂ≠∏Âì°Ë≥áÊñô‰∏≠Êõ¥Êñ∞Áè≠Âà•ÈÅ∏È†Ö
            await loadFromCloudSilently();
            
            // Ë®≠ÂÆöÈ†êË®≠Êó•ÊúüÁÇ∫‰ªäÂ§©
            document.getElementById('attendanceDate').value = new Date().toISOString().split('T')[0];
            
            // Ë®≠ÁΩÆÈªûÂêçÊåâÈàï‰∫ã‰ª∂Áõ£ËÅΩÂô®
            setupAttendanceButtons();
            
            loadTodayAttendance();
        });

        // Ê®ôÁ±§È†ÅÂàáÊèõ
        function showTab(tabName, element) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            if (element) {
                element.classList.add('active');
            }
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            if (tabName === 'attendance') {
                displayTodayAttendance();
            }
        }

        // È°ØÁ§∫ÈÄöÁü•
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // Êñ∞Â¢ûÂ≠∏Âì°
        async function addStudent() {
            const name = document.getElementById('studentName').value.trim();
            const className = document.getElementById('studentClass').value.trim();
            
            if (!name) {
                showNotification('Ë´ãËº∏ÂÖ•Â≠∏Âì°ÂßìÂêç', 'error');
                return;
            }
            
            if (!className) {
                showNotification('Ë´ãËº∏ÂÖ•Áè≠Âà•ÂêçÁ®±', 'error');
                return;
            }

            const student = {
                id: Date.now().toString(),
                name: name,
                nickname: document.getElementById('studentNickname').value.trim(),
                class: className,
                phone: document.getElementById('studentPhone').value.trim(),
                email: document.getElementById('studentEmail').value.trim(),
                status: document.getElementById('studentStatus').value,
                remarks: document.getElementById('studentRemarks').value.trim(),
                createdAt: new Date().toLocaleDateString('zh-TW')
            };

            students.push(student);
            localStorage.setItem('studentData', JSON.stringify(students));
            
            clearForm();
            displayStudents();
            updateClassOptions(); // Êõ¥Êñ∞Áè≠Âà•ÈÅ∏È†Ö
            updateStatistics();
            showNotification(`‚úÖ Â≠∏Âì°„Äå${name}„ÄçÂ∑≤ÊàêÂäüÊñ∞Â¢ûÂà∞„Äå${className}„Äç`, 'success');
            
            setTimeout(() => {
                syncToCloudSilently();
            }, 1000);
        }

        // Ê∏ÖÁ©∫Ë°®ÂñÆ
        function clearForm() {
            document.getElementById('studentName').value = '';
            document.getElementById('studentNickname').value = '';
            document.getElementById('studentClass').value = '';
            document.getElementById('studentPhone').value = '';
            document.getElementById('studentEmail').value = '';
            document.getElementById('studentStatus').value = 'Âú®ËÆÄ';
            document.getElementById('studentRemarks').value = '';
        }

        // ËºâÂÖ•Â≠∏Âì°Ë≥áÊñô
        async function loadStudents() {
            const localData = localStorage.getItem('studentData');
            if (localData) {
                try {
                    students = JSON.parse(localData);
                    console.log(`üìö ËºâÂÖ• ${students.length} Á≠ÜÊú¨Âú∞Â≠∏Âì°Ë≥áÊñô`);
                } catch (error) {
                    console.error('Êú¨Âú∞Ë≥áÊñôËß£ÊûêÂ§±Êïó:', error);
                    students = [];
                }
            } else {
                students = [];
            }
            
            displayStudents();
            updateClassOptions();
            updateStatistics();
        }

        // È°ØÁ§∫Â≠∏Âì°ÂàóË°®
        function displayStudents() {
            const list = document.getElementById('studentList');
            
            if (students.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <h3>üìö ÈÇÑÊ≤íÊúâÂ≠∏Âì°Ë≥áÊñô</h3>
                        <p>ÈªûÊìä‰∏äÊñπÁöÑ„ÄåÊñ∞Â¢ûÂ≠∏Âì°„ÄçÊåâÈàïÈñãÂßãÂª∫Á´ã‰Ω†ÁöÑÂ≠∏Âì°ÂêçÂÜä<br>
                        ÊâÄÊúâË≥áÊñôÊúÉÂÆâÂÖ®Âú∞ÂÑ≤Â≠òÂú®‰Ω†ÁöÑÁÄèË¶ΩÂô®‰∏≠</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = students.map(student => `
                <div class="student-item">
                    <div>
                        <div style="font-size: 20px; font-weight: 700; margin-bottom: 8px; color: #333;">
                            ${student.name}
                            ${student.nickname ? `<span style="color: #666; font-weight: 400; font-size: 16px;">(${student.nickname})</span>` : ''}
                        </div>
                        <div style="color: #666; font-size: 15px; margin-bottom: 5px;">
                            <span style="margin-right: 20px; background: #e3f2fd; padding: 4px 12px; border-radius: 20px; color: #1976d2;">
                                üìö ${student.class || 'Êú™ÂàÜÈÖçÁè≠Âà•'}
                            </span>
                            <span style="color: ${getStatusColor(student.status)}; font-weight: 600;">
                                ‚óè ${student.status}
                            </span>
                        </div>
                        <div style="color: #999; font-size: 13px;">
                            üìÖ ${student.createdAt} Âª∫Á´ã
                            ${student.phone ? ` | üìû ${student.phone}` : ''}
                            ${student.email ? ` | üìß ${student.email}` : ''}
                        </div>
                    </div>
                    <div>
                        <button class="btn btn-danger" onclick="deleteStudent('${student.id}')" 
                                title="Âà™Èô§Â≠∏Âì°" style="padding: 10px 15px;">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ÂèñÂæóÁãÄÊÖãÈ°èËâ≤
        function getStatusColor(status) {
            switch (status) {
                case 'Âú®ËÆÄ': return '#28a745';
                case '‰ºëÂ≠∏': return '#ffc107';
                case 'Áï¢Ê•≠': return '#6c757d';
                case 'ÈÄÄÂ≠∏': return '#dc3545';
                default: return '#007bff';
            }
        }

        // Âà™Èô§Â≠∏Âì°
        function deleteStudent(id) {
            const student = students.find(s => s.id === id);
            if (!student) return;
            
            if (confirm(`‚ö†Ô∏è Á¢∫ÂÆöË¶ÅÂà™Èô§Â≠∏Âì°„Äå${student.name}„ÄçÂóéÔºü\n\nÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©ÂéüÔºåË´ãË¨πÊÖéËÄÉÊÖÆ„ÄÇ`)) {
                students = students.filter(s => s.id !== id);
                localStorage.setItem('studentData', JSON.stringify(students));
                displayStudents();
                updateClassOptions(); // Êõ¥Êñ∞Áè≠Âà•ÈÅ∏È†Ö
                updateStatistics();
                showNotification(`üóëÔ∏è Â≠∏Âì°„Äå${student.name}„ÄçÂ∑≤Âà™Èô§`, 'warning');
            }
        }

        // Êõ¥Êñ∞Áè≠Âà•ÈÅ∏È†Ö - ÂæûÁèæÊúâÂ≠∏Âì°Ë≥áÊñô‰∏≠ÊèêÂèñ
        function updateClassOptions() {
            // ÂæûÂ≠∏Âì°Ë≥áÊñô‰∏≠ÊèêÂèñÊâÄÊúâÁè≠Âà•
            const classNames = [...new Set(students.map(s => s.class).filter(c => c && c.trim()))];
            
            // Êõ¥Êñ∞Êñ∞Â¢ûÂ≠∏Âì°ÁöÑ datalist
            const datalist = document.getElementById('classDatalist');
            datalist.innerHTML = classNames.map(className => `<option value="${className}">`).join('');
            
            // Êõ¥Êñ∞ÈªûÂêçÁ≥ªÁµ±ÁöÑ select
            const attendanceSelect = document.getElementById('attendanceClass');
            if (attendanceSelect) {
                const currentValue = attendanceSelect.value;
                attendanceSelect.innerHTML = '<option value="">Ë´ãÈÅ∏ÊìáÁè≠Âà•</option>' +
                    classNames.map(className => `<option value="${className}">${className}</option>`).join('');
                
                // ÊÅ¢Âæ©‰πãÂâçÈÅ∏ÊìáÁöÑÂÄº
                if (currentValue && classNames.includes(currentValue)) {
                    attendanceSelect.value = currentValue;
                }
            }
            
            console.log(`üìö Êõ¥Êñ∞Áè≠Âà•ÈÅ∏È†Ö: ${classNames.join(', ')}`);
        }

        // ÂêåÊ≠•Âà∞Èõ≤Á´Ø
        async function syncToCloud() {
            if (students.length === 0) {
                showNotification('Ê≤íÊúâÂ≠∏Âì°Ë≥áÊñôÂèØÂêåÊ≠•', 'warning');
                return;
            }

            try {
                showNotification('Ê≠£Âú®ÂêåÊ≠•Âà∞Èõ≤Á´Ø...', 'warning');
                document.getElementById('syncStatus').textContent = 'Ê≠£Âú®‰∏äÂÇ≥Ë≥áÊñôÂà∞ Google Sheets...';
                
                // Ê™¢Êü•ÊòØÂê¶ÁÇ∫ Vercel ÈÉ®ÁΩ≤ÁâàÊú¨
                const isVercel = window.location.hostname.includes('vercel.app');
                const apiUrl = isVercel ? '/api/sync-students' : window.location.origin + '/api/sync-students';
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ students })
                });

                const result = await response.json();
                
                if (result.success) {
                    showNotification(`‚úÖ ${result.message}`, 'success');
                    document.getElementById('syncStatus').textContent = `‚úÖ ${result.message} (${new Date().toLocaleString('zh-TW')})`;
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('ÂêåÊ≠•Â§±Êïó:', error);
                showNotification('‚ùå ÂêåÊ≠•Â§±Êïó: ' + error.message, 'error');
                document.getElementById('syncStatus').textContent = `‚ùå ÂêåÊ≠•Â§±Êïó: ${error.message}`;
            }
        }

        // ÈùúÈªòÂêåÊ≠•Âà∞Èõ≤Á´Ø
        async function syncToCloudSilently() {
            if (students.length === 0) return;
            try {
                const isVercel = window.location.hostname.includes('vercel.app');
                const apiUrl = isVercel ? '/api/sync-students' : window.location.origin + '/api/sync-students';
                
                await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ students })
                });
                console.log(`üîÑ Ëá™ÂãïÂêåÊ≠• ${students.length} Á≠ÜÂ≠∏Âì°Ë≥áÊñôÂà∞Èõ≤Á´Ø`);
            } catch (error) {
                console.log('üîÑ Ëá™ÂãïÂêåÊ≠•Â§±Êïó');
            }
        }

        // ÂæûÈõ≤Á´ØËºâÂÖ•
        async function loadFromCloud() {
            try {
                showNotification('Ê≠£Âú®ÂæûÈõ≤Á´ØËºâÂÖ•...', 'warning');
                document.getElementById('syncStatus').textContent = 'Ê≠£Âú®Âæû Google Sheets ËºâÂÖ•Ë≥áÊñô...';
                
                const isVercel = window.location.hostname.includes('vercel.app');
                const apiUrl = isVercel ? '/api/get-students' : window.location.origin + '/api/get-students';
                
                const response = await fetch(apiUrl);
                const result = await response.json();
                
                if (result.success && result.students) {
                    students = result.students;
                    localStorage.setItem('studentData', JSON.stringify(students));
                    displayStudents();
                    updateClassOptions();
                    updateStatistics();
                    showNotification(`‚úÖ ÊàêÂäüËºâÂÖ• ${result.count} Á≠ÜÂ≠∏Âì°Ë≥áÊñô`, 'success');
                    document.getElementById('syncStatus').textContent = `‚úÖ ÊàêÂäüËºâÂÖ• ${result.count} Á≠ÜË≥áÊñô (${new Date().toLocaleString('zh-TW')})`;
                } else {
                    throw new Error(result.error || 'ËºâÂÖ•Â§±Êïó');
                }
            } catch (error) {
                console.error('ËºâÂÖ•Â§±Êïó:', error);
                showNotification('‚ùå ËºâÂÖ•Â§±Êïó: ' + error.message, 'error');
                document.getElementById('syncStatus').textContent = `‚ùå ËºâÂÖ•Â§±Êïó: ${error.message}`;
            }
        }

        // ÈùúÈªòÂæûÈõ≤Á´ØËºâÂÖ•
        async function loadFromCloudSilently() {
            try {
                const isVercel = window.location.hostname.includes('vercel.app');
                const apiUrl = isVercel ? '/api/get-students' : window.location.origin + '/api/get-students';
                
                const response = await fetch(apiUrl);
                const result = await response.json();
                
                if (result.success && result.students && result.students.length > 0) {
                    if (result.students.length >= students.length) {
                        students = result.students;
                        localStorage.setItem('studentData', JSON.stringify(students));
                        displayStudents();
                        updateClassOptions();
                        console.log(`üîÑ Ëá™ÂãïËºâÂÖ• ${result.count} Á≠ÜÈõ≤Á´ØÂ≠∏Âì°Ë≥áÊñô`);
                    }
                }
            } catch (error) {
                console.log('üì± ‰ΩøÁî®Êú¨Âú∞Ê®°Âºè');
            }
        }

        // Êõ¥Êñ∞Áµ±Ë®à
        function updateStatistics() {
            const total = students.length;
            const active = students.filter(s => s.status === 'Âú®ËÆÄ').length;
            const suspended = students.filter(s => s.status === '‰ºëÂ≠∏').length;
            const graduated = students.filter(s => s.status === 'Áï¢Ê•≠').length;

            // Â¶ÇÊûúÊúâÁµ±Ë®àÂÖÉÁ¥†ÊâçÊõ¥Êñ∞
            const totalElement = document.getElementById('totalStudents');
            if (totalElement) {
                totalElement.textContent = total;
                document.getElementById('activeStudents').textContent = active;
                document.getElementById('suspendedStudents').textContent = suspended;
                document.getElementById('graduatedStudents').textContent = graduated;
            }
        }

        // ÈñãÂßãÈªûÂêç
        function startAttendance() {
            const date = document.getElementById('attendanceDate').value;
            const className = document.getElementById('attendanceClass').value;
            
            console.log('=== ÈñãÂßãÈªûÂêç ===');
            console.log('ÈÅ∏ÊìáÊó•Êúü:', date);
            console.log('ÈÅ∏ÊìáÁè≠Âà•:', className);
            
            if (!date || !className) {
                showNotification('Ë´ãÈÅ∏ÊìáÊó•ÊúüÂíåÁè≠Âà•', 'error');
                console.log('‚ùå Êó•ÊúüÊàñÁè≠Âà•Êú™ÈÅ∏Êìá');
                return;
            }
            
            currentAttendanceDate = date;
            currentAttendanceClass = className;
            
            console.log('‚úÖ Ë®≠ÂÆöÂÖ®ÂüüËÆäÊï∏:');
            console.log('- currentAttendanceDate:', currentAttendanceDate);
            console.log('- currentAttendanceClass:', currentAttendanceClass);
            
            // Áç≤ÂèñË©≤Áè≠Âà•ÁöÑÂ≠∏Âì°
            const classStudents = students.filter(s => s.class === className);
            console.log(`üìö ${className} ÁöÑÂ≠∏Âì°:`, classStudents);
            
            if (classStudents.length === 0) {
                showNotification(`${className} Ê≤íÊúâÂ≠∏Âì°Ë≥áÊñô`, 'warning');
                console.log('‚ùå Ë©≤Áè≠Âà•Ê≤íÊúâÂ≠∏Âì°');
                return;
            }
            
            console.log(`‚úÖ ÊâæÂà∞ ${classStudents.length} ‰ΩçÂ≠∏Âì°`);
            
            // È°ØÁ§∫ÈªûÂêçÂàóË°®
            displayAttendanceList(classStudents);
            document.getElementById('attendanceListCard').style.display = 'block';
            
            // Ë®≠ÁΩÆÈªûÂêçÊåâÈàï‰∫ã‰ª∂Áõ£ËÅΩÂô®
            setupAttendanceButtons();
            
            showNotification(`ÈñãÂßã ${className} ÁöÑÈªûÂêç`, 'success');
            console.log('‚úÖ ÈªûÂêçÂàóË°®Â∑≤È°ØÁ§∫');
        }
        
        // È°ØÁ§∫ÈªûÂêçÂàóË°®
        function displayAttendanceList(classStudents) {
            const container = document.getElementById('attendanceStudentsList');
            
            container.innerHTML = classStudents.map(student => `
                <div class="student-item" style="margin-bottom: 20px; padding: 20px; border-radius: 15px;">
                    <div style="margin-bottom: 15px;">
                        <div style="font-size: 20px; font-weight: 600; margin-bottom: 8px; color: #333;">
                            ${student.name}
                            ${student.nickname ? `<span style="color: #666; font-size: 16px;">(${student.nickname})</span>` : ''}
                        </div>
                        <div style="font-size: 14px; color: #666;">
                            Â≠∏Âì°ID: ${student.id}
                        </div>
                    </div>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                        <button class="attendance-btn btn btn-success" 
                                onclick="markAttendanceNew('${student.id}', 'Âá∫Â∏≠', this)"
                                data-student-id="${student.id}" 
                                data-status="Âá∫Â∏≠" 
                                style="padding: 12px 24px; font-size: 16px; font-weight: 600; border-radius: 10px; position: relative; min-width: 100px;">
                            <span class="btn-text">‚úÖ Âá∫Â∏≠</span>
                            <span class="check-mark" style="display: none; position: absolute; top: -5px; right: -5px; background: #fff; border-radius: 50%; width: 20px; height: 20px; color: #28a745; font-size: 14px; line-height: 20px;">‚úì</span>
                        </button>
                        <button class="attendance-btn btn btn-warning" 
                                onclick="markAttendanceNew('${student.id}', 'Ë´ãÂÅá', this)"
                                data-student-id="${student.id}" 
                                data-status="Ë´ãÂÅá" 
                                style="padding: 12px 24px; font-size: 16px; font-weight: 600; border-radius: 10px; position: relative; min-width: 100px;">
                            <span class="btn-text">üè• Ë´ãÂÅá</span>
                            <span class="check-mark" style="display: none; position: absolute; top: -5px; right: -5px; background: #fff; border-radius: 50%; width: 20px; height: 20px; color: #ffc107; font-size: 14px; line-height: 20px;">‚úì</span>
                        </button>
                        <button class="attendance-btn btn btn-primary" 
                                onclick="markAttendanceNew('${student.id}', 'ÈÅ≤Âà∞', this)"
                                data-student-id="${student.id}" 
                                data-status="ÈÅ≤Âà∞" 
                                style="padding: 12px 24px; font-size: 16px; font-weight: 600; border-radius: 10px; position: relative; min-width: 100px;">
                            <span class="btn-text">‚è∞ ÈÅ≤Âà∞</span>
                            <span class="check-mark" style="display: none; position: absolute; top: -5px; right: -5px; background: #fff; border-radius: 50%; width: 20px; height: 20px; color: #007bff; font-size: 14px; line-height: 20px;">‚úì</span>
                        </button>
                    </div>
                </div>
            `).join('');
            
            console.log('‚úÖ ÈªûÂêçÂàóË°®Â∑≤ÁîüÊàêÔºåÂåÖÂê´ onclick ‰∫ã‰ª∂');
        }
        
        // Êñ∞ÁöÑÊ®ôË®òÂá∫Â∏≠ÁãÄÊÖãÂáΩÊï∏ - Áõ¥Êé•ÈÄèÈÅé onclick Ë™øÁî®
        function markAttendanceNew(studentId, status, clickedButton) {
            console.log('=== Êñ∞ÁöÑÊ®ôË®òÂá∫Â∏≠ÁãÄÊÖã ===');
            console.log('Â≠∏Âì°ID:', studentId);
            console.log('ÁãÄÊÖã:', status);
            console.log('ÈªûÊìäÁöÑÊåâÈàï:', clickedButton);
            console.log('Áï∂ÂâçÊó•Êúü:', currentAttendanceDate);
            console.log('Áï∂ÂâçÁè≠Âà•:', currentAttendanceClass);
            
            // Ê™¢Êü•ÂøÖË¶ÅÁöÑËÆäÊï∏
            if (!currentAttendanceDate || !currentAttendanceClass) {
                console.error('‚ùå Áº∫Â∞ëÂøÖË¶ÅËÆäÊï∏');
                showNotification('Ë´ãÈáçÊñ∞ÈñãÂßãÈªûÂêç', 'error');
                return;
            }
            
            const student = students.find(s => s.id === studentId);
            if (!student) {
                console.error('‚ùå Êâæ‰∏çÂà∞Â≠∏Âì°:', studentId);
                showNotification('Êâæ‰∏çÂà∞Â≠∏Âì°Ë≥áÊñô', 'error');
                return;
            }
            
            console.log('‚úÖ ÊâæÂà∞Â≠∏Âì°:', student.name);
            
            // ÁßªÈô§Ë©≤Â≠∏Âì°ÁöÑËàäË®òÈåÑ
            const originalLength = todayAttendance.length;
            todayAttendance = todayAttendance.filter(att => 
                !(att.studentId === studentId && att.date === currentAttendanceDate && att.className === currentAttendanceClass)
            );
            
            if (todayAttendance.length < originalLength) {
                console.log(`üóëÔ∏è ÁßªÈô§‰∫Ü ${originalLength - todayAttendance.length} Á≠ÜËàäË®òÈåÑ`);
            }
            
            // Ê∑ªÂä†Êñ∞Ë®òÈåÑ
            const newRecord = {
                id: 'ATT_' + Date.now(),
                date: currentAttendanceDate,
                className: currentAttendanceClass,
                studentId: studentId,
                studentName: student.name,
                status: status,
                createdAt: new Date().toLocaleString('zh-TW')
            };
            
            todayAttendance.push(newRecord);
            console.log('‚úÖ Êñ∞Â¢ûË®òÈåÑ:', newRecord);
            console.log('ÁõÆÂâçÁ∏ΩË®òÈåÑÊï∏:', todayAttendance.length);
            
            // Êõ¥Êñ∞Ë©≤Â≠∏Âì°ÁöÑÊâÄÊúâÊåâÈàïÁãÄÊÖã
            const studentButtons = document.querySelectorAll(`button[data-student-id="${studentId}"]`);
            console.log(`ÊâæÂà∞ ${studentButtons.length} ÂÄãÊåâÈàïÈúÄË¶ÅÊõ¥Êñ∞`);
            
            // ÈáçÁΩÆÊâÄÊúâÊåâÈàïÁãÄÊÖã
            studentButtons.forEach(btn => {
                btn.classList.remove('selected');
                btn.style.backgroundColor = '';
                btn.style.borderColor = '';
                btn.style.transform = 'scale(1)';
                
                // Èö±ËóèÊâÄÊúâÂãæËôü
                const checkMark = btn.querySelector('.check-mark');
                if (checkMark) {
                    checkMark.style.display = 'none';
                }
            });
            
            // Ë®≠ÂÆöÈªûÊìäÊåâÈàïÁÇ∫ÈÅ∏‰∏≠ÁãÄÊÖã
            if (clickedButton) {
                clickedButton.classList.add('selected');
                clickedButton.style.transform = 'scale(0.95)';
                clickedButton.style.borderWidth = '3px';
                
                // È°ØÁ§∫ÂãæËôü
                const checkMark = clickedButton.querySelector('.check-mark');
                if (checkMark) {
                    checkMark.style.display = 'block';
                }
                
                // Ê†πÊìöÁãÄÊÖãË®≠ÂÆö‰∏çÂêåÁöÑÂº∑Ë™øËâ≤
                switch(status) {
                    case 'Âá∫Â∏≠':
                        clickedButton.style.backgroundColor = '#198754';
                        clickedButton.style.borderColor = '#146c43';
                        break;
                    case 'Ë´ãÂÅá':
                        clickedButton.style.backgroundColor = '#fd7e14';
                        clickedButton.style.borderColor = '#fd7e14';
                        break;
                    case 'ÈÅ≤Âà∞':
                        clickedButton.style.backgroundColor = '#0d6efd';
                        clickedButton.style.borderColor = '#0a58ca';
                        break;
                }
                
                console.log('‚úÖ ÊåâÈàïË¶ñË¶∫ÁãÄÊÖãÂ∑≤Êõ¥Êñ∞');
            }
            
            // È°ØÁ§∫ÊàêÂäüË®äÊÅØ
            showNotification(`‚úÖ ${student.name} Â∑≤Ê®ôË®òÁÇ∫„Äå${status}„Äç`, 'success');
            
            // Êí≠ÊîæÈªûÊìäÈü≥ÊïàÔºàÂ¶ÇÊûúÊîØÊè¥ÁöÑË©±Ôºâ
            try {
                // ÂâµÂª∫Áü≠Êö´ÁöÑÈü≥ÊïàÂèçÈ•ã
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (e) {
                // Èü≥Êïà‰∏çÊîØÊè¥ÊôÇÂøΩÁï•
            }
        }

        // Ë®≠ÁΩÆÈªûÂêçÊåâÈàï‰∫ã‰ª∂Áõ£ËÅΩÂô® - ÁèæÂú®ÊîπÁî® onclickÔºåÈÄôÂÄãÂáΩÊï∏‰øùÁïô‰ΩÜÁ∞°Âåñ
        function setupAttendanceButtons() {
            console.log('‚úÖ ÈªûÂêçÊåâÈàï‰ΩøÁî®Áõ¥Êé• onclick ‰∫ã‰ª∂ÔºåÁÑ°ÈúÄÈ°çÂ§ñË®≠ÁΩÆ');
        }

        // ÂÑ≤Â≠òÈªûÂêçË®òÈåÑ
        async function saveAttendance() {
            console.log('=== ÈñãÂßãÂÑ≤Â≠òÈªûÂêçË®òÈåÑ ===');
            console.log('Áï∂ÂâçÈªûÂêçË®òÈåÑ:', todayAttendance);
            console.log('Ë®òÈåÑÊï∏Èáè:', todayAttendance.length);
            
            if (todayAttendance.length === 0) {
                showNotification('Ë´ãÂÖàÁÇ∫Â≠∏Âì°Ê®ôË®òÂá∫Â∏≠ÁãÄÊÖã', 'warning');
                console.log('‚ùå Ê≤íÊúâÈªûÂêçË®òÈåÑÔºåÂÅúÊ≠¢ÂÑ≤Â≠ò');
                return;
            }
            
            try {
                // ÂÑ≤Â≠òÂà∞Êú¨Âú∞
                localStorage.setItem('todayAttendance', JSON.stringify(todayAttendance));
                console.log('‚úÖ Â∑≤ÂÑ≤Â≠òÂà∞ localStorage');
                
                // È©óË≠âÂÑ≤Â≠òÊòØÂê¶ÊàêÂäü
                const savedData = localStorage.getItem('todayAttendance');
                const parsedData = JSON.parse(savedData);
                console.log('‚úÖ È©óË≠âÂÑ≤Â≠òÊàêÂäüÔºåË®òÈåÑÊï∏:', parsedData.length);
                
                // Êõ¥Êñ∞È°ØÁ§∫
                displayTodayAttendance();
                updateAttendanceCount();
                
                // È°ØÁ§∫ÊàêÂäüË®äÊÅØ
                showNotification(`‚úÖ Â∑≤Êú¨Âú∞ÂÑ≤Â≠ò ${todayAttendance.length} Á≠ÜÈªûÂêçË®òÈåÑ`, 'success');
                console.log(`‚úÖ ÂÑ≤Â≠òÂÆåÊàêÔºåÂÖ± ${todayAttendance.length} Á≠ÜË®òÈåÑ`);
                
                // Èö±ËóèÈªûÂêçÂàóË°®
                document.getElementById('attendanceListCard').style.display = 'none';
                
            } catch (error) {
                console.error('‚ùå ÂÑ≤Â≠òÂ§±Êïó:', error);
                showNotification('‚ùå ÂÑ≤Â≠òÂ§±Êïó: ' + error.message, 'error');
            }
        }
        
        // ÈáçÊñ∞ÈªûÂêç
        function resetAttendance() {
            if (confirm('Á¢∫ÂÆöË¶ÅÈáçÊñ∞ÈªûÂêçÂóéÔºüÈÄôÊúÉÊ∏ÖÈô§ÁõÆÂâçÁöÑÈªûÂêçÁãÄÊÖã„ÄÇ')) {
                // Ê∏ÖÈô§‰ªäÊó•Ë©≤Áè≠Âà•ÁöÑË®òÈåÑ
                todayAttendance = todayAttendance.filter(att => 
                    !(att.date === currentAttendanceDate && att.className === currentAttendanceClass)
                );
                
                // ÈáçÊñ∞ÈñãÂßãÈªûÂêç
                startAttendance();
                showNotification('Â∑≤ÈáçÊñ∞ÈñãÂßãÈªûÂêç', 'success');
            }
        }
        
        // ËºâÂÖ•‰ªäÊó•Âá∫Â∏≠Ë®òÈåÑ
        function loadTodayAttendance() {
            const saved = localStorage.getItem('todayAttendance');
            if (saved) {
                todayAttendance = JSON.parse(saved);
            }
            displayTodayAttendance();
            updateAttendanceCount();
        }

        // Êõ¥Êñ∞ÈªûÂêçË®òÈåÑÊï∏Èáè
        function updateAttendanceCount() {
            const countElement = document.getElementById('attendanceCount');
            if (countElement) {
                countElement.textContent = todayAttendance.length;
            }
        }

        // È°ØÁ§∫ÈªûÂêçË®òÈåÑ
        function showAttendanceRecords() {
            if (todayAttendance.length === 0) {
                showNotification('Ê≤íÊúâÈªûÂêçË®òÈåÑ', 'warning');
                return;
            }
            
            let recordsText = 'üìã Êú¨Âú∞ÈªûÂêçË®òÈåÑÔºö\n\n';
            todayAttendance.forEach(record => {
                recordsText += `üìÖ ${record.date} | üìö ${record.className}\n`;
                recordsText += `üë§ ${record.studentName} - ${record.status}\n`;
                recordsText += `‚è∞ ${record.createdAt}\n\n`;
            });
            
            alert(recordsText);
        }

        // ÂêåÊ≠•ÈªûÂêçË®òÈåÑÂà∞Èõ≤Á´ØÔºàÁ∞°ÂåñÁâàÔºâ
        function syncAttendanceToCloud() {
            if (todayAttendance.length === 0) {
                showNotification('Ê≤íÊúâÈªûÂêçË®òÈåÑÂèØÂêåÊ≠•', 'warning');
                return;
            }
            
            // Á∞°ÂåñËôïÁêÜÔºöÊèêÁ§∫Áî®Êà∂ÊâãÂãïËº∏ÂÖ•Âà∞Google Sheets
            const recordsForCopy = todayAttendance.map(record => 
                `${record.date}\t${record.className}\t${record.studentName}\t${record.status}`
            ).join('\n');
            
            const header = 'date\tclass\tstudentName\tstatus\n';
            const fullData = header + recordsForCopy;
            
            // Ë§áË£ΩÂà∞Ââ™Ë≤ºÊùø
            navigator.clipboard.writeText(fullData).then(() => {
                showNotification(`‚úÖ Â∑≤Ë§áË£Ω ${todayAttendance.length} Á≠ÜË®òÈåÑÂà∞Ââ™Ë≤ºÊùøÔºåÂèØÁõ¥Êé•Ë≤ºÂà∞Google Sheets`, 'success');
                alert(`üìã ÈªûÂêçË®òÈåÑÂ∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÊùøÔºÅ\n\nË´ãÂà∞ÊÇ®ÁöÑGoogle SheetsÊâãÂãïË≤º‰∏äÔºö\n1. ÈñãÂïüÊÇ®ÁöÑGoogle Sheets\n2. ÈÅ∏Êìá„Äåattendance„ÄçÂ∑•‰ΩúË°®\n3. ÊåâCtrl+VË≤º‰∏äË≥áÊñô\n\nË®òÈåÑÊ†ºÂºèÔºöÊó•Êúü | Áè≠Âà• | Â≠∏Âì°ÂßìÂêç | ÁãÄÊÖã`);
            }).catch(() => {
                // Â¶ÇÊûúË§áË£ΩÂ§±ÊïóÔºåÈ°ØÁ§∫Ë≥áÊñôËÆìÁî®Êà∂ÊâãÂãïË§áË£Ω
                const textarea = document.createElement('textarea');
                textarea.value = fullData;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                
                showNotification('Ë´ãÊâãÂãïË§áË£Ω‰∏ãÊñπË≥áÊñôÂà∞Google Sheets', 'warning');
                alert(`Ë´ãË§áË£Ω‰ª•‰∏ãË≥áÊñôÂà∞Google SheetsÔºö\n\n${fullData}`);
            });
        }
        
        // È°ØÁ§∫‰ªäÊó•Âá∫Â∏≠Ë®òÈåÑ
        function displayTodayAttendance() {
            const list = document.getElementById('todayAttendanceList');
            const today = new Date().toISOString().split('T')[0];
            const todayRecords = todayAttendance.filter(att => att.date === today);
            
            if (todayRecords.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <h3>üìù ÈÇÑÊ≤íÊúâ‰ªäÊó•ÁöÑÈªûÂêçË®òÈåÑ</h3>
                        <p>ÈÅ∏ÊìáÁè≠Âà•‰∏¶ÈñãÂßãÈªûÂêç</p>
                    </div>
                `;
                return;
            }
            
            // ÊåâÁè≠Âà•ÂàÜÁµÑ
            const groupedByClass = {};
            todayRecords.forEach(att => {
                if (!groupedByClass[att.className]) {
                    groupedByClass[att.className] = [];
                }
                groupedByClass[att.className].push(att);
            });
            
            let html = '';
            Object.keys(groupedByClass).forEach(className => {
                const classRecords = groupedByClass[className];
                html += `
                    <div style="margin-bottom: 30px;">
                        <h4 style="color: #333; margin-bottom: 15px; font-size: 18px;">üìö ${className}</h4>
                        ${classRecords.map(att => `
                            <div class="student-item" style="margin-bottom: 10px;">
                                <div>
                                    <div style="font-size: 16px; font-weight: 600; color: #333;">
                                        ${att.studentName}
                                        <span style="color: ${getAttendanceColor(att.status)}; font-weight: 600; margin-left: 10px;">
                                            ${getAttendanceIcon(att.status)} ${att.status}
                                        </span>
                                    </div>
                                    <div style="color: #999; font-size: 13px;">
                                        üìù ${att.createdAt}
                                    </div>
                                </div>
                                <div>
                                    <button class="btn btn-danger" onclick="deleteAttendance('${att.id}')" 
                                            title="Âà™Èô§Ë®òÈåÑ" style="padding: 8px 12px; font-size: 12px;">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            });
            
            list.innerHTML = html;
        }

        // Áç≤ÂèñÂá∫Â∏≠ÁãÄÊÖãÈ°èËâ≤
        function getAttendanceColor(status) {
            switch (status) {
                case 'Âá∫Â∏≠': return '#28a745';
                case 'Áº∫Â∏≠': return '#dc3545';
                case 'Ë´ãÂÅá': return '#6c757d';
                case 'ÈÅ≤Âà∞': return '#ffc107';
                default: return '#007bff';
            }
        }

        // Áç≤ÂèñÂá∫Â∏≠ÁãÄÊÖãÂúñÊ®ô
        function getAttendanceIcon(status) {
            switch (status) {
                case 'Âá∫Â∏≠': return '‚úÖ';
                case 'Áº∫Â∏≠': return '‚ùå';
                case 'Ë´ãÂÅá': return 'üè•';
                case 'ÈÅ≤Âà∞': return '‚è∞';
                default: return 'üìù';
            }
        }

        // Âà™Èô§Âá∫Â∏≠Ë®òÈåÑ
        function deleteAttendance(id) {
            const att = todayAttendance.find(a => a.id === id);
            if (!att) return;
            
            if (confirm(`Á¢∫ÂÆöË¶ÅÂà™Èô§„Äå${att.studentName}„ÄçÁöÑÈªûÂêçË®òÈåÑÂóéÔºü`)) {
                todayAttendance = todayAttendance.filter(a => a.id !== id);
                localStorage.setItem('todayAttendance', JSON.stringify(todayAttendance));
                displayTodayAttendance();
                showNotification(`üóëÔ∏è Â∑≤Âà™Èô§ÈªûÂêçË®òÈåÑ`, 'warning');
            }
        }
    </script>
</body>
</html> 
