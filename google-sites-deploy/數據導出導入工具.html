<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>æ•¸æ“šå°å‡ºå°å…¥å·¥å…·</title>
    <style>
        body { font-family: system-ui; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .section { margin-bottom: 30px; padding: 20px; border: 1px solid #dee2e6; border-radius: 8px; }
        .btn { padding: 12px 24px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 10px 5px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        textarea { width: 100%; height: 200px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-family: monospace; font-size: 12px; }
        .alert { padding: 15px; margin: 15px 0; border-radius: 4px; }
        .alert-info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .alert-success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .alert-warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 15px 0; }
        .stat-card { background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; }
        .stat-number { font-size: 24px; font-weight: bold; color: #007bff; }
        .stat-label { font-size: 14px; color: #6c757d; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“± æ•¸æ“šå°å‡ºå°å…¥å·¥å…·</h1>
        <p>ç”¨é€™å€‹å·¥å…·åœ¨ä¸åŒè¨­å‚™é–“è½‰ç§»ä½ çš„å­¸å“¡ç®¡ç†æ•¸æ“š</p>

        <!-- ç•¶å‰æ•¸æ“šç‹€æ…‹ -->
        <div class="section">
            <h3>ğŸ“Š ç•¶å‰æ•¸æ“šç‹€æ…‹</h3>
            <div class="stats" id="current-stats">
                <div class="stat-card">
                    <div class="stat-number" id="student-count">0</div>
                    <div class="stat-label">å­¸å“¡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="class-count">0</div>
                    <div class="stat-label">ç­çµ„</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="attendance-count">0</div>
                    <div class="stat-label">å‡ºå¸­è¨˜éŒ„</div>
                </div>
            </div>
            <button class="btn btn-primary" onclick="refreshStats()">ğŸ”„ åˆ·æ–°çµ±è¨ˆ</button>
        </div>

        <!-- å°å‡ºæ•¸æ“š -->
        <div class="section">
            <h3>ğŸ“¤ å°å‡ºæ•¸æ“š</h3>
            <div class="alert alert-info">
                <strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong>
                <ol>
                    <li>é»æ“Šã€Œå°å‡ºæ•¸æ“šã€æŒ‰éˆ•</li>
                    <li>è¤‡è£½ä¸‹æ–¹æ–‡å­—æ¡†ä¸­çš„æ‰€æœ‰å…§å®¹</li>
                    <li>é€é WhatsAppã€Email ç­‰æ–¹å¼ç™¼é€åˆ°å…¶ä»–è¨­å‚™</li>
                </ol>
            </div>
            <button class="btn btn-primary" onclick="exportData()">ğŸ“¤ å°å‡ºæ•¸æ“š</button>
            <button class="btn btn-warning" onclick="clearExportArea()">ğŸ—‘ï¸ æ¸…ç©º</button>
            <br><br>
            <textarea id="export-area" placeholder="å°å‡ºçš„æ•¸æ“šæœƒé¡¯ç¤ºåœ¨é€™è£¡..." readonly></textarea>
        </div>

        <!-- å°å…¥æ•¸æ“š -->
        <div class="section">
            <h3>ğŸ“¥ å°å…¥æ•¸æ“š</h3>
            <div class="alert alert-warning">
                <strong>âš ï¸ æ³¨æ„ï¼š</strong>å°å…¥æ•¸æ“šæœƒ<strong>è¦†è“‹</strong>ç•¶å‰æ‰€æœ‰æ•¸æ“šï¼Œè«‹å…ˆç¢ºèªå‚™ä»½ï¼
            </div>
            <textarea id="import-area" placeholder="å°‡å°å‡ºçš„æ•¸æ“šè²¼ä¸Šåˆ°é€™è£¡..."></textarea>
            <br><br>
            <button class="btn btn-success" onclick="importData()">ğŸ“¥ å°å…¥æ•¸æ“š</button>
            <button class="btn btn-warning" onclick="clearImportArea()">ğŸ—‘ï¸ æ¸…ç©º</button>
        </div>

        <!-- æ¸…ç©ºæ•¸æ“š -->
        <div class="section">
            <h3>ğŸ—‘ï¸ æ¸…ç©ºæ•¸æ“š</h3>
            <div class="alert alert-warning">
                <strong>âš ï¸ å±éšªæ“ä½œï¼š</strong>é€™æœƒåˆªé™¤æ‰€æœ‰æœ¬åœ°æ•¸æ“šï¼Œç„¡æ³•å¾©åŸï¼
            </div>
            <button class="btn btn-warning" onclick="clearAllData()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ•¸æ“š</button>
        </div>

        <!-- çµæœé¡¯ç¤º -->
        <div id="result-message"></div>
    </div>

    <script>
        // æª¢æŸ¥æ•¸æ“šç‰ˆæœ¬
        const DATA_VERSIONS = [
            { key: 'wp_students_v3', name: 'å­¸å“¡æ•¸æ“š (WordPressç‰ˆ)' },
            { key: 'wp_classes_v3', name: 'ç­çµ„æ•¸æ“š (WordPressç‰ˆ)' },
            { key: 'wp_attendance_v3', name: 'å‡ºå¸­æ•¸æ“š (WordPressç‰ˆ)' },
            { key: 'gs_students_v1', name: 'å­¸å“¡æ•¸æ“š (Google Sheetsç‰ˆ)' },
            { key: 'gs_classes_v1', name: 'ç­çµ„æ•¸æ“š (Google Sheetsç‰ˆ)' },
            { key: 'gs_attendance_v1', name: 'å‡ºå¸­æ•¸æ“š (Google Sheetsç‰ˆ)' }
        ];

        // é é¢è¼‰å…¥æ™‚åˆ·æ–°çµ±è¨ˆ
        document.addEventListener('DOMContentLoaded', refreshStats);

        // åˆ·æ–°çµ±è¨ˆ
        function refreshStats() {
            let totalStudents = 0;
            let totalClasses = 0;
            let totalAttendance = 0;

            // æª¢æŸ¥æ‰€æœ‰ç‰ˆæœ¬çš„æ•¸æ“š
            DATA_VERSIONS.forEach(version => {
                const data = localStorage.getItem(version.key);
                if (data) {
                    try {
                        const parsed = JSON.parse(data);
                        if (version.key.includes('students')) {
                            totalStudents += Array.isArray(parsed) ? parsed.length : 0;
                        } else if (version.key.includes('classes')) {
                            totalClasses += Array.isArray(parsed) ? parsed.length : 0;
                        } else if (version.key.includes('attendance')) {
                            totalAttendance += Object.keys(parsed).length || 0;
                        }
                    } catch (e) {
                        console.error('è§£ææ•¸æ“šå¤±æ•—:', version.key, e);
                    }
                }
            });

            document.getElementById('student-count').textContent = totalStudents;
            document.getElementById('class-count').textContent = totalClasses;
            document.getElementById('attendance-count').textContent = totalAttendance;
        }

        // å°å‡ºæ•¸æ“š
        function exportData() {
            const exportData = {
                timestamp: new Date().toISOString(),
                version: '1.0',
                data: {}
            };

            // æ”¶é›†æ‰€æœ‰æ•¸æ“š
            DATA_VERSIONS.forEach(version => {
                const data = localStorage.getItem(version.key);
                if (data) {
                    try {
                        exportData.data[version.key] = JSON.parse(data);
                    } catch (e) {
                        console.error('å°å‡ºæ•¸æ“šå¤±æ•—:', version.key, e);
                    }
                }
            });

            // è½‰æ›ç‚º JSON å­—ç¬¦ä¸²
            const jsonString = JSON.stringify(exportData, null, 2);
            document.getElementById('export-area').value = jsonString;

            showMessage('âœ… æ•¸æ“šå°å‡ºå®Œæˆï¼è«‹è¤‡è£½ä¸Šæ–¹æ–‡å­—æ¡†ä¸­çš„å…§å®¹ã€‚', 'success');
        }

        // å°å…¥æ•¸æ“š
        function importData() {
            const importText = document.getElementById('import-area').value.trim();
            
            if (!importText) {
                showMessage('âŒ è«‹å…ˆè²¼ä¸Šè¦å°å…¥çš„æ•¸æ“šï¼', 'warning');
                return;
            }

            try {
                const importData = JSON.parse(importText);
                
                // é©—è­‰æ•¸æ“šæ ¼å¼
                if (!importData.data || typeof importData.data !== 'object') {
                    throw new Error('æ•¸æ“šæ ¼å¼ä¸æ­£ç¢º');
                }

                // ç¢ºèªå°å…¥
                if (!confirm('ç¢ºå®šè¦å°å…¥æ•¸æ“šå—ï¼Ÿé€™æœƒè¦†è“‹ç•¶å‰æ‰€æœ‰æ•¸æ“šï¼')) {
                    return;
                }

                // å°å…¥æ•¸æ“š
                let importCount = 0;
                Object.keys(importData.data).forEach(key => {
                    localStorage.setItem(key, JSON.stringify(importData.data[key]));
                    importCount++;
                });

                refreshStats();
                showMessage(`âœ… æˆåŠŸå°å…¥ ${importCount} é …æ•¸æ“šï¼`, 'success');
                
                // æ¸…ç©ºå°å…¥å€åŸŸ
                document.getElementById('import-area').value = '';

            } catch (e) {
                console.error('å°å…¥å¤±æ•—:', e);
                showMessage('âŒ å°å…¥å¤±æ•—ï¼šæ•¸æ“šæ ¼å¼ä¸æ­£ç¢ºæˆ–å·²æå£ï¼', 'warning');
            }
        }

        // æ¸…ç©ºæ‰€æœ‰æ•¸æ“š
        function clearAllData() {
            if (!confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰æ•¸æ“šå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
                return;
            }

            if (!confirm('æœ€å¾Œç¢ºèªï¼šçœŸçš„è¦åˆªé™¤æ‰€æœ‰å­¸å“¡ã€ç­çµ„å’Œå‡ºå¸­æ•¸æ“šå—ï¼Ÿ')) {
                return;
            }

            // åˆªé™¤æ‰€æœ‰ç›¸é—œæ•¸æ“š
            DATA_VERSIONS.forEach(version => {
                localStorage.removeItem(version.key);
            });

            // ä¹Ÿåˆªé™¤ API è¨­å®š
            localStorage.removeItem('gs_api_key');
            localStorage.removeItem('gs_sheet_id');

            refreshStats();
            showMessage('âœ… æ‰€æœ‰æ•¸æ“šå·²æ¸…ç©ºï¼', 'success');
        }

        // æ¸…ç©ºæ–‡å­—å€åŸŸ
        function clearExportArea() {
            document.getElementById('export-area').value = '';
        }

        function clearImportArea() {
            document.getElementById('import-area').value = '';
        }

        // é¡¯ç¤ºè¨Šæ¯
        function showMessage(message, type = 'info') {
            const resultDiv = document.getElementById('result-message');
            const alertClass = `alert-${type}`;
            
            resultDiv.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;
            
            // 3ç§’å¾Œè‡ªå‹•éš±è—
            setTimeout(() => {
                resultDiv.innerHTML = '';
            }, 5000);
        }

        // è‡ªå‹•é¸æ“‡æ–‡å­—æ¡†å…§å®¹
        document.getElementById('export-area').addEventListener('click', function() {
            this.select();
        });
    </script>
</body>
</html> 