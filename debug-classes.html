<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>班別資料結構診斷</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; }
        .card { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; background: #007bff; color: white; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto; }
        .error { color: #dc3545; }
        .success { color: #28a745; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <h1>🔍 班別資料結構診斷工具</h1>
    
    <div class="card">
        <h3>🎯 測試 Google Apps Script 班別資料</h3>
        <button onclick="debugClasses()">檢查班別資料結構</button>
        <button onclick="clearLog()">清除日誌</button>
    </div>
    
    <div class="card">
        <h3>📊 診斷結果</h3>
        <div id="log"></div>
    </div>

    <script>
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw_m3SjHokYxU-eUkFrMtcrVXnoxSGhRAfuUxYDt6P81UwmxcMrkKjz-h7A4teL8kKIjQ/exec';
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        async function debugClasses() {
            try {
                log('🔄 開始檢查班別資料...', 'info');
                
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL + '?action=getClasses', {
                    method: 'GET',
                    redirect: 'follow',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                log(`📡 HTTP 狀態: ${response.status}`, response.ok ? 'success' : 'error');
                
                const result = await response.json();
                log('📋 完整回應:', 'info');
                log(`<pre>${JSON.stringify(result, null, 2)}</pre>`, 'info');
                
                if (result.success && result.classes) {
                    log(`✅ 成功取得 ${result.count} 個班別`, 'success');
                    
                    result.classes.forEach((classItem, index) => {
                        log(`📌 班別 ${index + 1}:`, 'info');
                        log(`<pre>類型: ${typeof classItem}</pre>`, 'info');
                        log(`<pre>內容: ${JSON.stringify(classItem, null, 2)}</pre>`, 'info');
                        
                        if (typeof classItem === 'object' && classItem !== null) {
                            const keys = Object.keys(classItem);
                            log(`🔑 可用欄位: ${keys.join(', ')}`, 'info');
                            
                            // 檢查可能的班別名稱欄位
                            const possibleNameFields = ['class_id', 'class_name', '名稱', 'name', 'className', '班別'];
                            possibleNameFields.forEach(field => {
                                if (classItem[field]) {
                                    log(`✅ 找到班別名稱欄位 "${field}": "${classItem[field]}"`, 'success');
                                }
                            });
                        }
                        log('---', 'info');
                    });
                } else {
                    log(`❌ 載入失敗: ${result.error || '未知錯誤'}`, 'error');
                }
                
            } catch (error) {
                log(`❌ 錯誤: ${error.message}`, 'error');
                console.error('Debug error:', error);
            }
        }
        
        // 頁面載入時顯示資訊
        window.onload = function() {
            log('🎯 班別資料結構診斷工具已準備就緒', 'info');
            log(`📍 Google Apps Script URL: ${GOOGLE_APPS_SCRIPT_URL}`, 'info');
        };
    </script>
</body>
</html> 