<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­åˆ¥è³‡æ–™çµæ§‹è¨ºæ–·</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; }
        .card { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; background: #007bff; color: white; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto; }
        .error { color: #dc3545; }
        .success { color: #28a745; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <h1>ğŸ” ç­åˆ¥è³‡æ–™çµæ§‹è¨ºæ–·å·¥å…·</h1>
    
    <div class="card">
        <h3>ğŸ¯ æ¸¬è©¦ Google Apps Script ç­åˆ¥è³‡æ–™</h3>
        <button onclick="debugClasses()">æª¢æŸ¥ç­åˆ¥è³‡æ–™çµæ§‹</button>
        <button onclick="clearLog()">æ¸…é™¤æ—¥èªŒ</button>
    </div>
    
    <div class="card">
        <h3>ğŸ“Š è¨ºæ–·çµæœ</h3>
        <div id="log"></div>
    </div>

    <script>
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw_m3SjHokYxU-eUkFrMtcrVXnoxSGhRAfuUxYDt6P81UwmxcMrkKjz-h7A4teL8kKIjQ/exec';
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        async function debugClasses() {
            try {
                log('ğŸ”„ é–‹å§‹æª¢æŸ¥ç­åˆ¥è³‡æ–™...', 'info');
                
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL + '?action=getClasses', {
                    method: 'GET',
                    redirect: 'follow',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                log(`ğŸ“¡ HTTP ç‹€æ…‹: ${response.status}`, response.ok ? 'success' : 'error');
                
                const result = await response.json();
                log('ğŸ“‹ å®Œæ•´å›æ‡‰:', 'info');
                log(`<pre>${JSON.stringify(result, null, 2)}</pre>`, 'info');
                
                if (result.success && result.classes) {
                    log(`âœ… æˆåŠŸå–å¾— ${result.count} å€‹ç­åˆ¥`, 'success');
                    
                    result.classes.forEach((classItem, index) => {
                        log(`ğŸ“Œ ç­åˆ¥ ${index + 1}:`, 'info');
                        log(`<pre>é¡å‹: ${typeof classItem}</pre>`, 'info');
                        log(`<pre>å…§å®¹: ${JSON.stringify(classItem, null, 2)}</pre>`, 'info');
                        
                        if (typeof classItem === 'object' && classItem !== null) {
                            const keys = Object.keys(classItem);
                            log(`ğŸ”‘ å¯ç”¨æ¬„ä½: ${keys.join(', ')}`, 'info');
                            
                            // æª¢æŸ¥å¯èƒ½çš„ç­åˆ¥åç¨±æ¬„ä½
                            const possibleNameFields = ['class_id', 'class_name', 'åç¨±', 'name', 'className', 'ç­åˆ¥'];
                            possibleNameFields.forEach(field => {
                                if (classItem[field]) {
                                    log(`âœ… æ‰¾åˆ°ç­åˆ¥åç¨±æ¬„ä½ "${field}": "${classItem[field]}"`, 'success');
                                }
                            });
                        }
                        log('---', 'info');
                    });
                } else {
                    log(`âŒ è¼‰å…¥å¤±æ•—: ${result.error || 'æœªçŸ¥éŒ¯èª¤'}`, 'error');
                }
                
            } catch (error) {
                log(`âŒ éŒ¯èª¤: ${error.message}`, 'error');
                console.error('Debug error:', error);
            }
        }
        
        // é é¢è¼‰å…¥æ™‚é¡¯ç¤ºè³‡è¨Š
        window.onload = function() {
            log('ğŸ¯ ç­åˆ¥è³‡æ–™çµæ§‹è¨ºæ–·å·¥å…·å·²æº–å‚™å°±ç·’', 'info');
            log(`ğŸ“ Google Apps Script URL: ${GOOGLE_APPS_SCRIPT_URL}`, 'info');
        };
    </script>
</body>
</html> 