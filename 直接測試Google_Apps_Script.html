<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›´æ¥æ¸¬è©¦ Google Apps Script</title>
    <style>
        body { font-family: -apple-system, sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; }
        .result { padding: 15px; margin: 10px 0; border-radius: 8px; white-space: pre-wrap; font-family: monospace; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        button { background: #007bff; color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>ğŸ” ç›´æ¥æ¸¬è©¦ Google Apps Script</h1>
    
    <p><strong>ç›®æ¨™ URL:</strong> <br>
    <code>https://script.google.com/macros/s/AKfycbw_m3SjHokYxU-eUkFrMtcrVXnoxSGhRAfuUxYDt6P81UwmxcMrkKjz-h7A4teL8kKIjQ/exec</code></p>
    
    <button onclick="testBasicAccess()">ğŸ”— æ¸¬è©¦åŸºæœ¬è¨ªå•</button>
    <button onclick="testGetClasses()">ğŸ“š æ¸¬è©¦è¼‰å…¥ç­åˆ¥</button>
    <button onclick="testGetStudents()">ğŸ‘¥ æ¸¬è©¦è¼‰å…¥å­¸å“¡</button>
    <button onclick="clearResults()">ğŸ§¹ æ¸…é™¤çµæœ</button>
    
    <div id="results"></div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw_m3SjHokYxU-eUkFrMtcrVXnoxSGhRAfuUxYDt6P81UwmxcMrkKjz-h7A4teL8kKIjQ/exec';
        
        function showResult(title, content, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>${title}</strong>\n${content}`;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        async function testBasicAccess() {
            showResult('ğŸ”— æ¸¬è©¦åŸºæœ¬è¨ªå•', 'æ­£åœ¨æ¸¬è©¦...', 'info');
            
            try {
                // æ¸¬è©¦ä¸åŒçš„è«‹æ±‚æ–¹å¼
                const response = await fetch(SCRIPT_URL, {
                    method: 'GET',
                    redirect: 'follow',
                    mode: 'cors'
                });
                
                console.log('Response details:', {
                    status: response.status,
                    statusText: response.statusText,
                    headers: [...response.headers.entries()],
                    url: response.url,
                    redirected: response.redirected
                });
                
                const text = await response.text();
                
                showResult('ğŸ“Š å›æ‡‰è©³æƒ…', 
                    `ç‹€æ…‹: ${response.status} ${response.statusText}\n` +
                    `URL: ${response.url}\n` +
                    `é‡å®šå‘: ${response.redirected}\n` +
                    `å…§å®¹é¡å‹: ${response.headers.get('content-type')}\n` +
                    `å…§å®¹é•·åº¦: ${text.length} å­—ç¬¦\n\n` +
                    `å›æ‡‰å…§å®¹å‰ 500 å­—ç¬¦:\n${text.substring(0, 500)}${text.length > 500 ? '...' : ''}`, 
                    'info'
                );
                
                // æª¢æŸ¥æ˜¯å¦æ˜¯ HTML
                if (text.trim().startsWith('<!DOCTYPE') || text.trim().startsWith('<html')) {
                    showResult('âŒ å•é¡Œç¢ºèª', 
                        'âŒ Google Apps Script è¿”å› HTML è€Œä¸æ˜¯ JSON\n' +
                        'é€™è¡¨ç¤º:\n' +
                        '1. éƒ¨ç½²è¨­å®šæœ‰å•é¡Œ\n' +
                        '2. æ¬Šé™æˆ–æˆæ¬Šå•é¡Œ\n' +
                        '3. Google Apps Script ä»£ç¢¼æœ‰éŒ¯èª¤\n\n' +
                        'å»ºè­°:\n' +
                        '1. æª¢æŸ¥ Google Apps Script éƒ¨ç½²ç‹€æ…‹\n' +
                        '2. ç¢ºèªåŸ·è¡Œèº«åˆ†å’Œå­˜å–æ¬Šé™è¨­å®š\n' +
                        '3. é‡æ–°æˆæ¬Šæ¬Šé™', 
                        'error'
                    );
                } else {
                    try {
                        const json = JSON.parse(text);
                        showResult('âœ… JSON è§£ææˆåŠŸ', JSON.stringify(json, null, 2), 'success');
                    } catch (e) {
                        showResult('âŒ JSON è§£æå¤±æ•—', `éŒ¯èª¤: ${e.message}\nåŸå§‹å…§å®¹: ${text}`, 'error');
                    }
                }
                
            } catch (error) {
                showResult('âŒ è«‹æ±‚å¤±æ•—', `éŒ¯èª¤: ${error.message}\né¡å‹: ${error.name}`, 'error');
            }
        }

        async function testGetClasses() {
            showResult('ğŸ“š æ¸¬è©¦è¼‰å…¥ç­åˆ¥', 'æ­£åœ¨æ¸¬è©¦ getClasses...', 'info');
            
            try {
                const url = `${SCRIPT_URL}?action=getClasses`;
                const response = await fetch(url, {
                    method: 'GET',
                    redirect: 'follow'
                });
                
                const text = await response.text();
                
                showResult('ğŸ“š ç­åˆ¥è«‹æ±‚çµæœ', 
                    `è«‹æ±‚ URL: ${url}\n` +
                    `ç‹€æ…‹: ${response.status}\n` +
                    `å›æ‡‰: ${text}`, 
                    response.ok ? 'success' : 'error'
                );
                
            } catch (error) {
                showResult('âŒ ç­åˆ¥è«‹æ±‚å¤±æ•—', error.message, 'error');
            }
        }

        async function testGetStudents() {
            showResult('ğŸ‘¥ æ¸¬è©¦è¼‰å…¥å­¸å“¡', 'æ­£åœ¨æ¸¬è©¦ getStudents...', 'info');
            
            try {
                const url = `${SCRIPT_URL}?action=getStudents`;
                const response = await fetch(url, {
                    method: 'GET',
                    redirect: 'follow'
                });
                
                const text = await response.text();
                
                showResult('ğŸ‘¥ å­¸å“¡è«‹æ±‚çµæœ', 
                    `è«‹æ±‚ URL: ${url}\n` +
                    `ç‹€æ…‹: ${response.status}\n` +
                    `å›æ‡‰: ${text}`, 
                    response.ok ? 'success' : 'error'
                );
                
            } catch (error) {
                showResult('âŒ å­¸å“¡è«‹æ±‚å¤±æ•—', error.message, 'error');
            }
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æ¸¬è©¦
        window.onload = function() {
            showResult('ğŸš€ é–‹å§‹è¨ºæ–·', 'æ­£åœ¨æ¸¬è©¦ Google Apps Script é€£æ¥...', 'info');
            testBasicAccess();
        };
    </script>
</body>
</html> 